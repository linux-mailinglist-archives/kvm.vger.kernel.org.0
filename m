Return-Path: <kvm-owner@vger.kernel.org>
X-Original-To: lists+kvm@lfdr.de
Delivered-To: lists+kvm@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 55FA0645ED
	for <lists+kvm@lfdr.de>; Wed, 10 Jul 2019 13:51:22 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726338AbfGJLvV (ORCPT <rfc822;lists+kvm@lfdr.de>);
        Wed, 10 Jul 2019 07:51:21 -0400
Received: from mga04.intel.com ([192.55.52.120]:38171 "EHLO mga04.intel.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1726043AbfGJLvV (ORCPT <rfc822;kvm@vger.kernel.org>);
        Wed, 10 Jul 2019 07:51:21 -0400
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
  by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 10 Jul 2019 04:51:19 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,474,1557212400"; 
   d="scan'208";a="170898018"
Received: from fmsmsx104.amr.corp.intel.com ([10.18.124.202])
  by orsmga006.jf.intel.com with ESMTP; 10 Jul 2019 04:51:19 -0700
Received: from FMSMSX110.amr.corp.intel.com (10.18.116.10) by
 fmsmsx104.amr.corp.intel.com (10.18.124.202) with Microsoft SMTP Server (TLS)
 id 14.3.439.0; Wed, 10 Jul 2019 04:51:18 -0700
Received: from shsmsx106.ccr.corp.intel.com (10.239.4.159) by
 fmsmsx110.amr.corp.intel.com (10.18.116.10) with Microsoft SMTP Server (TLS)
 id 14.3.439.0; Wed, 10 Jul 2019 04:51:18 -0700
Received: from shsmsx104.ccr.corp.intel.com ([169.254.5.110]) by
 SHSMSX106.ccr.corp.intel.com ([169.254.10.240]) with mapi id 14.03.0439.000;
 Wed, 10 Jul 2019 19:51:17 +0800
From:   "Liu, Yi L" <yi.l.liu@intel.com>
To:     Peter Xu <zhexu@redhat.com>
CC:     "qemu-devel@nongnu.org" <qemu-devel@nongnu.org>,
        "mst@redhat.com" <mst@redhat.com>,
        "pbonzini@redhat.com" <pbonzini@redhat.com>,
        "alex.williamson@redhat.com" <alex.williamson@redhat.com>,
        "eric.auger@redhat.com" <eric.auger@redhat.com>,
        "david@gibson.dropbear.id.au" <david@gibson.dropbear.id.au>,
        "Tian, Kevin" <kevin.tian@intel.com>,
        "Tian, Jun J" <jun.j.tian@intel.com>,
        "Sun, Yi Y" <yi.y.sun@intel.com>,
        "kvm@vger.kernel.org" <kvm@vger.kernel.org>,
        Jacob Pan <jacob.jun.pan@linux.intel.com>,
        Yi Sun <yi.y.sun@linux.intel.com>
Subject: RE: [RFC v1 06/18] intel_iommu: support virtual command emulation
 and pasid request
Thread-Topic: [RFC v1 06/18] intel_iommu: support virtual command emulation
 and pasid request
Thread-Index: AQHVM+ylOC+MxRu5MEOwKVcZdjCE5KbBHCcAgAKbkLA=
Date:   Wed, 10 Jul 2019 11:51:17 +0000
Message-ID: <A2975661238FB949B60364EF0F2C257439F2A65F@SHSMSX104.ccr.corp.intel.com>
References: <1562324511-2910-1-git-send-email-yi.l.liu@intel.com>
 <1562324511-2910-7-git-send-email-yi.l.liu@intel.com>
 <20190709031902.GD5178@xz-x1>
In-Reply-To: <20190709031902.GD5178@xz-x1>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
dlp-product: dlpe-windows
dlp-version: 11.0.600.7
dlp-reaction: no-action
x-ctpclassification: CTP_NT
x-titus-metadata-40: eyJDYXRlZ29yeUxhYmVscyI6IiIsIk1ldGFkYXRhIjp7Im5zIjoiaHR0cDpcL1wvd3d3LnRpdHVzLmNvbVwvbnNcL0ludGVsMyIsImlkIjoiNDBmYTFjMWMtNjRhZS00Yzc4LWE3NzUtZTRiMTI1NjI5YWUxIiwicHJvcHMiOlt7Im4iOiJDVFBDbGFzc2lmaWNhdGlvbiIsInZhbHMiOlt7InZhbHVlIjoiQ1RQX05UIn1dfV19LCJTdWJqZWN0TGFiZWxzIjpbXSwiVE1DVmVyc2lvbiI6IjE3LjEwLjE4MDQuNDkiLCJUcnVzdGVkTGFiZWxIYXNoIjoiVDBzSzRUYWsyT3draDVSYnZkd0JMM1dvRlFCWjc3QXN4ZHUwZWFtdEVCR0JkOHhpRFBZcTJ6b0V2emh4cGtjcSJ9
x-originating-ip: [10.239.127.40]
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org

PiBGcm9tOiBQZXRlciBYdSBbbWFpbHRvOnpoZXh1QHJlZGhhdC5jb21dDQo+IFNlbnQ6IFR1ZXNk
YXksIEp1bHkgOSwgMjAxOSAxMToxOSBBTQ0KPiBTdWJqZWN0OiBSZTogW1JGQyB2MSAwNi8xOF0g
aW50ZWxfaW9tbXU6IHN1cHBvcnQgdmlydHVhbCBjb21tYW5kIGVtdWxhdGlvbiBhbmQNCj4gcGFz
aWQgcmVxdWVzdA0KPiANCj4gT24gRnJpLCBKdWwgMDUsIDIwMTkgYXQgMDc6MDE6MzlQTSArMDgw
MCwgTGl1IFlpIEwgd3JvdGU6DQo+ID4gVGhpcyBwYXRjaCBhZGRzIHZpcnR1YWwgY29tbWFuZCBz
dXBwb3J0IHRvIEludGVsIHZJT01NVSBwZXIgSW50ZWwgVlQtZCAzLjENCj4gPiBzcGVjLiBUaGlz
IHBhdGNoIGFkZHMgdHdvIHZpcnR1YWwgY29tbWFuZHM6IGFsbG9jX3Bhc2lkIGFuZCBmcmVlX3Bh
c2lkLg0KPiA+DQo+ID4gQ2M6IEtldmluIFRpYW4gPGtldmluLnRpYW5AaW50ZWwuY29tPg0KPiA+
IENjOiBKYWNvYiBQYW4gPGphY29iLmp1bi5wYW5AbGludXguaW50ZWwuY29tPg0KPiA+IENjOiBQ
ZXRlciBYdSA8cGV0ZXJ4QHJlZGhhdC5jb20+DQo+ID4gQ2M6IFlpIFN1biA8eWkueS5zdW5AbGlu
dXguaW50ZWwuY29tPg0KPiA+IFNpZ25lZC1vZmYtYnk6IExpdSBZaSBMIDx5aS5sLmxpdUBpbnRl
bC5jb20+DQo+ID4gU2lnbmVkLW9mZi1ieTogWWkgU3VuIDx5aS55LnN1bkBsaW51eC5pbnRlbC5j
b20+DQo+ID4gLS0tDQo+ID4gIGh3L2kzODYvaW50ZWxfaW9tbXUuYyAgICAgICAgICB8IDEzOQ0K
PiArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrLQ0KPiA+ICBody9pMzg2
L2ludGVsX2lvbW11X2ludGVybmFsLmggfCAgMzAgKysrKysrKysrDQo+ID4gIGh3L2kzODYvdHJh
Y2UtZXZlbnRzICAgICAgICAgICB8ICAgMSArDQo+ID4gIGluY2x1ZGUvaHcvaTM4Ni9pbnRlbF9p
b21tdS5oICB8ICAgNiArLQ0KPiA+ICA0IGZpbGVzIGNoYW5nZWQsIDE3NCBpbnNlcnRpb25zKCsp
LCAyIGRlbGV0aW9ucygtKQ0KPiA+DQo+ID4gZGlmZiAtLWdpdCBhL2h3L2kzODYvaW50ZWxfaW9t
bXUuYyBiL2h3L2kzODYvaW50ZWxfaW9tbXUuYw0KPiA+IGluZGV4IDMxNjBhMDUuLjNjZjI1MGQg
MTAwNjQ0DQo+ID4gLS0tIGEvaHcvaTM4Ni9pbnRlbF9pb21tdS5jDQo+ID4gKysrIGIvaHcvaTM4
Ni9pbnRlbF9pb21tdS5jDQo+ID4gQEAgLTkzMiwxMSArOTMyLDE5IEBAIHN0YXRpYyBWVERCdXMN
Cj4gKnZ0ZF9maW5kX2FzX2Zyb21fYnVzX251bShJbnRlbElPTU1VU3RhdGUgKnMsIHVpbnQ4X3Qg
YnVzX251bSkNCj4gPiAgICAgICAgICAgICAgICAgIHMtPnZ0ZF9hc19ieV9idXNfbnVtW2J1c19u
dW1dID0gdnRkX2J1czsNCj4gPiAgICAgICAgICAgICAgICAgIHJldHVybiB2dGRfYnVzOw0KPiA+
ICAgICAgICAgICAgICB9DQo+ID4gKyAgICAgICAgICAgIHZ0ZF9idXMgPSBOVUxMOw0KPiANCj4g
Q2FuIG1vdmUgdG8gLi4uDQo+ID4gICAgICAgICAgfQ0KPiANCj4gLi4uIGhlcmU/DQoNCnllcywg
aXQgaXMuIGNvdWxkIHNhdmUgdmFyaWFibGUgYXNzaWdubWVudHMuDQoNCj4gPiAgICAgIH0NCj4g
PiAgICAgIHJldHVybiB2dGRfYnVzOw0KPiA+ICB9DQo+ID4NCj4gPiArc3RhdGljIFBDSUJ1cyAq
dnRkX2ZpbmRfcGNpX2J1c19mcm9tX2J1c19udW0oSW50ZWxJT01NVVN0YXRlICpzLA0KPiA+ICsg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90IGJ1c19u
dW0pDQo+ID4gK3sNCj4gPiArICAgIFZUREJ1cyAqdnRkX2J1cyA9IHZ0ZF9maW5kX2FzX2Zyb21f
YnVzX251bShzLCBidXNfbnVtKTsNCj4gPiArICAgIHJldHVybiB2dGRfYnVzID8gdnRkX2J1cy0+
YnVzIDogTlVMTDsNCj4gPiArfQ0KPiA+ICsNCj4gPiAgLyogR2l2ZW4gdGhlIEBpb3ZhLCBnZXQg
cmVsZXZhbnQgQHNscHRlcC4gQHNscHRlX2xldmVsIHdpbGwgYmUgdGhlIGxhc3QgbGV2ZWwNCj4g
PiAgICogb2YgdGhlIHRyYW5zbGF0aW9uLCBjYW4gYmUgdXNlZCBmb3IgZGVjaWRpbmcgdGhlIHNp
emUgb2YgbGFyZ2UgcGFnZS4NCj4gPiAgICovDQo+ID4gQEAgLTI1NzksNiArMjU4NywxMDMgQEAg
c3RhdGljIHZvaWQgdnRkX2hhbmRsZV9pZWN0bF93cml0ZShJbnRlbElPTU1VU3RhdGUNCj4gKnMp
DQo+ID4gICAgICB9DQo+ID4gIH0NCj4gPg0KPiA+ICtzdGF0aWMgaW50IHZ0ZF9yZXF1ZXN0X3Bh
c2lkX2FsbG9jKEludGVsSU9NTVVTdGF0ZSAqcykNCj4gPiArew0KPiA+ICsgICAgUENJQnVzICpi
dXM7DQo+ID4gKyAgICBpbnQgYnVzX24sIGRldmZuOw0KPiA+ICsNCj4gPiArICAgIGZvciAoYnVz
X24gPSAwOyBidXNfbiA8IFBDSV9CVVNfTUFYOyBidXNfbisrKSB7DQo+ID4gKyAgICAgICAgYnVz
ID0gdnRkX2ZpbmRfcGNpX2J1c19mcm9tX2J1c19udW0ocywgYnVzX24pOw0KPiA+ICsgICAgICAg
IGlmICghYnVzKSB7DQo+ID4gKyAgICAgICAgICAgIGNvbnRpbnVlOw0KPiA+ICsgICAgICAgIH0N
Cj4gPiArICAgICAgICBmb3IgKGRldmZuID0gMDsgZGV2Zm4gPCBQQ0lfREVWRk5fTUFYOyBkZXZm
bisrKSB7DQo+ID4gKyAgICAgICAgICAgIGlmIChwY2lfZGV2aWNlX2lzX29wc19zZXQoYnVzLCBk
ZXZmbikpIHsNCj4gPiArICAgICAgICAgICAgICAgIHJldHVybiBwY2lfZGV2aWNlX3JlcXVlc3Rf
cGFzaWRfYWxsb2MoYnVzLCBkZXZmbiwNCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgVlREX01JTl9IUEFTSUQsDQo+ID4gKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZURF9NQVhfSFBB
U0lEKTsNCj4gDQo+IEFoIHNvIGhlcmUgSSBzZWUgd2h5IHBjaV9kZXZpY2VfaXNfb3BzX3NldCgp
IGlzIG5lY2Vzc2FyeS4uLiB5b3UNCj4gd2FudGVkIHRvIGZpbmQgYSBkZXZpY2UgdGhhdCBpcyB2
ZmlvLXBjaSBhbmQgc3VwcG9ydHMgUEFTSUQuICBUaGlzIGlzDQo+IGEgYml0IGF3a3dhcmQgYnV0
IGluZGVlZCBJIGRvbid0IGtub3cgd2hhdCdzIGEgYmV0dGVyIG9wdGlvbiB0byBtYWtlDQo+IGl0
IGEgY2xlYXJlciBpbnRlcmZhY2UgaWYgd2UgY2FuJ3QgbGV0IElPTU1VIHRvIHRhbGsgZGlyZWN0
bHkgdG8gdmZpby4NCg0KeWVzLCBpdCBpcy4NCg0KPiBUSGUgdGhpbmcgaXMgdGhhdCBWRklPX0lP
TU1VX1BBU0lEX1JFUVVFU1Qgc2VlbXMgdG8gYmUgZGVmaW5lZCBwZXINCj4gVkZJTyBjb250YWlu
ZXIsIHdoaWxlIFZULWQgc3BlYyBpcyBvZiBjb3Vyc2UgZGVmaW5pbmcgUEFTSUQgYWxsb2NhdGlv
bg0KPiBhcyBnbG9iYWxseS4gDQoNCnJpZ2h0Lg0KDQo+IE1vcmUgY29udGV4dCBvbiBob3cgdGhl
IHBhc2lkIGFkZHJlc3Mgc3BhY2Ugd2lsbCBiZQ0KPiBkZWZpbmVkIGFuZCBjb25zaWRlcmF0aW9u
cyBiZWhpbmQgKG5vdCBvbmx5IGZvciB0aGlzIHNlcmllcywgYnV0IGZvcg0KPiB0aGUgYmlnIHBp
Y3R1cmUgb2YgU1ZBIHdvcmspIHdvdWxkIGJlIGdyZWF0bHkgd2VsY29tZWQuDQoNCmFscmVhZHkg
bm90aWNlZCBpbiBvdGhlciByZXBsaWVzLiBsZXQncyBhbGlnbiBvbmUgYnkgb25lLg0KDQo+ID4g
KyAgICAgICAgICAgIH0NCj4gPiArICAgICAgICB9DQo+ID4gKyAgICB9DQo+ID4gKyAgICByZXR1
cm4gLTE7DQo+ID4gK30NCj4gPiArDQo+ID4gK3N0YXRpYyBpbnQgdnRkX3JlcXVlc3RfcGFzaWRf
ZnJlZShJbnRlbElPTU1VU3RhdGUgKnMsIHVpbnQzMl90IHBhc2lkKQ0KPiA+ICt7DQo+ID4gKyAg
ICBQQ0lCdXMgKmJ1czsNCj4gPiArICAgIGludCBidXNfbiwgZGV2Zm47DQo+ID4gKw0KPiA+ICsg
ICAgZm9yIChidXNfbiA9IDA7IGJ1c19uIDwgUENJX0JVU19NQVg7IGJ1c19uKyspIHsNCj4gPiAr
ICAgICAgICBidXMgPSB2dGRfZmluZF9wY2lfYnVzX2Zyb21fYnVzX251bShzLCBidXNfbik7DQo+
ID4gKyAgICAgICAgaWYgKCFidXMpIHsNCj4gPiArICAgICAgICAgICAgY29udGludWU7DQo+ID4g
KyAgICAgICAgfQ0KPiA+ICsgICAgICAgIGZvciAoZGV2Zm4gPSAwOyBkZXZmbiA8IFBDSV9ERVZG
Tl9NQVg7IGRldmZuKyspIHsNCj4gPiArICAgICAgICAgICAgaWYgKHBjaV9kZXZpY2VfaXNfb3Bz
X3NldChidXMsIGRldmZuKSkgew0KPiA+ICsgICAgICAgICAgICAgICAgcmV0dXJuIHBjaV9kZXZp
Y2VfcmVxdWVzdF9wYXNpZF9mcmVlKGJ1cywgZGV2Zm4sIHBhc2lkKTsNCj4gPiArICAgICAgICAg
ICAgfQ0KPiA+ICsgICAgICAgIH0NCj4gPiArICAgIH0NCj4gPiArICAgIHJldHVybiAtMTsNCj4g
PiArfQ0KPiA+ICsNCj4gPiArLyogSGFuZGxlIHdyaXRlIHRvIFZpcnR1YWwgQ29tbWFuZCBSZWdp
c3RlciAqLw0KPiA+ICtzdGF0aWMgdm9pZCB2dGRfaGFuZGxlX3ZjbWRfd3JpdGUoSW50ZWxJT01N
VVN0YXRlICpzKQ0KPiA+ICt7DQo+ID4gKyAgICB1aW50MzJfdCBzdGF0dXMgPSB2dGRfZ2V0X2xv
bmdfcmF3KHMsIERNQVJfVkNSU1BfUkVHKTsNCj4gPiArICAgIHVpbnQzMl90IHZhbCA9IHZ0ZF9n
ZXRfbG9uZ19yYXcocywgRE1BUl9WQ01EX1JFRyk7DQo+ID4gKyAgICB1aW50MzJfdCBwYXNpZDsN
Cj4gPiArICAgIGludCByZXQgPSAtMTsNCj4gPiArDQo+ID4gKyAgICB0cmFjZV92dGRfcmVnX3dy
aXRlX3ZjbWQoc3RhdHVzLCB2YWwpOw0KPiANCj4gQ291bGQgd2UgdXNlIHMtPnZjcnNwIGRpcmVj
dGx5IGluc3RlYWQgb2YgdXNpbmcgRE1BUl9WQ1JTUF9SRUc/DQoNCnllcywgSSB0aGluayBzby4N
Cg0KPiA+ICsNCj4gPiArICAgIHN3aXRjaCAodmFsICYgVlREX1ZDTURfQ01EX01BU0spIHsNCj4g
PiArICAgIGNhc2UgVlREX1ZDTURfQUxMT0NfUEFTSUQ6DQo+ID4gKyAgICAgICAgaWYgKCEocy0+
dmNjYXAgJiBWVERfVkNDQVBfUEFTKSB8fA0KPiA+ICsgICAgICAgICAgICAgKHMtPnZjcnNwICYg
MSkpIHsNCj4gDQo+IE5pdDogd2UgY2FuIGNvbnNpZGVyIHRvIG9mZmVyIHNvbWUgaGVscGVycyBm
b3IgdGhlbS4NCg0Kd2lsbCBoYXZlIGhlbHBlciBmb3IgdGhlbS4NCg0KPiBBbHNvLCBJIHRoaW5r
IHdlIHNob3VsZCBjaGVjayB2Y3JzcCYxIGF0IHRoZSBlbnRyeSBmb3IgYWxsIHZjbWRzLiBbMV0N
Cg0KQWdyZWVkLg0KDQo+ID4gKyAgICAgICAgICAgIGJyZWFrOw0KPiA+ICsgICAgICAgIH0NCj4g
PiArICAgICAgICBzLT52Y3JzcCA9IDE7DQo+ID4gKyAgICAgICAgdnRkX3NldF9xdWFkX3Jhdyhz
LCBETUFSX1ZDUlNQX1JFRywNCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICgodWludDY0
X3QpIHMtPnZjcnNwKSk7DQo+IA0KPiBEbyB3ZSByZWFsbHkgbmVlZCB0byBlbXVsYXRlIHRoZSAi
SW4gUHJvZ3Jlc3MiIGxpa2UgdGhpcz8gIFRoZSB2Y3B1IGlzDQo+IGJsb2NrZWQgaGVyZSBhZnRl
ciBhbGwsIGFuZCBBRkFJQ1QgYWxsIHRoZSByZXN0IG9mIHZjcHVzIHNob3VsZCBub3QNCj4gYWNj
ZXNzIHRoZXNlIHJlZ2lzdGVycyBiZWNhdXNlIG9idmlvdXNseSB0aGVzZSByZWdpc3RlcnMgY2Fu
bm90IGJlDQo+IGFjY2Vzc2VkIGNvbmN1cnJlbnRseS4uLg0KDQpPdGhlciB2Y3B1cyBzaG91bGQg
cG9sbCB0aGUgSVAgYml0IGJlZm9yZSBzdWJtaXR0aW5nIHZjbWRzLiBBcyBJUCBiaXQNCmlzIHNl
dCwgb3RoZXIgdmNwdXMgd2lsbCBub3QgYWNjZXNzIHRoZXNlIGJpdHMuIGJ1dCBpZiBub3QsIHRo
ZXkgbWF5IHN1Ym1pdA0KbmV3IHZjbWRzLCB3aGlsZSB3ZSBvbmx5IGhhdmUgMSByZXNwb25zZSBy
ZWdpc3RlciwgdGhhdCBpcyBub3Qgd2UNCnN1cHBvcnQuIFRoYXQncyB3aHkgd2UgbmVlZCB0byBz
ZXQgSVAgYml0Lg0KDQo+IA0KPiBJIHRoaW5rIHRoZSBJUCBiaXQgaXMgdXNlZnVsIHdoZW4gc29t
ZSBuZXcgdmNtZCB3b3VsZCB0YWtlIHBsZW50eSBvZg0KPiB0aW1lIHNvIHRoYXQgd2UgY2FuIGRv
IHRoZSBsb25nIHZjbWRzIGluIGFzeW5jIHdheS4gIEhvd2V2ZXIgaGVyZSBpdA0KPiBzZWVtcyBu
b3QgdGhlIGNhc2U/DQoNCm5vLCBzbyBmYXIsIGl0IGlzIHN5bmNocm9uaXplIHdheS4gQXMgbWVu
dGlvbmVkIGFib3ZlLCBJUCBiaXQgaXMgdG8gZW5zdXJlDQpvbmx5IG9uZSB2Y21kIGlzIGhhbmRs
ZWQgZm9yIGEgdGltZS4gT3RoZXIgdmNwdXMgd29uJ3QgYmUgYWJsZSB0byBzdWJtaXQNCnZjbWRz
IGJlZm9yZSBJUCBpcyBjbGVhcmVkLg0KDQo+ID4gKyAgICAgICAgcmV0ID0gdnRkX3JlcXVlc3Rf
cGFzaWRfYWxsb2Mocyk7DQo+ID4gKyAgICAgICAgaWYgKHJldCA8IDApIHsNCj4gPiArICAgICAg
ICAgICAgcy0+dmNyc3AgfD0gVlREX1ZDUlNQX1NDKFZURF9WQ01EX05PX0FWQUlMQUJMRV9QQVNJ
RCk7DQo+ID4gKyAgICAgICAgfSBlbHNlIHsNCj4gPiArICAgICAgICAgICAgcy0+dmNyc3AgfD0g
VlREX1ZDUlNQX1JTTFQocmV0KTsNCj4gPiArICAgICAgICB9DQo+ID4gKyAgICAgICAgcy0+dmNy
c3AgJj0gKH4oKHVpbnQ2NF90KSgweDEpKSk7DQo+ID4gKyAgICAgICAgdnRkX3NldF9xdWFkX3Jh
dyhzLCBETUFSX1ZDUlNQX1JFRywNCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICgodWlu
dDY0X3QpIHMtPnZjcnNwKSk7DQo+ID4gKyAgICAgICAgYnJlYWs7DQo+ID4gKw0KPiA+ICsgICAg
Y2FzZSBWVERfVkNNRF9GUkVFX1BBU0lEOg0KPiA+ICsgICAgICAgIGlmICghKHMtPnZjY2FwICYg
VlREX1ZDQ0FQX1BBUykgfHwNCj4gPiArICAgICAgICAgICAgIChzLT52Y3JzcCAmIDEpKSB7DQo+
ID4gKyAgICAgICAgICAgIGJyZWFrOw0KPiA+ICsgICAgICAgIH0NCj4gPiArICAgICAgICBzLT52
Y3JzcCAmPSAxOw0KPiA+ICsgICAgICAgIHZ0ZF9zZXRfcXVhZF9yYXcocywgRE1BUl9WQ1JTUF9S
RUcsDQo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAoKHVpbnQ2NF90KSBzLT52Y3JzcCkp
Ow0KPiANCj4gU2FtZSBoZXJlIG9uIElQIGJpdCBlbXVsYXRpb24uICBJTUhPIHdlIGNhbiBkcm9w
IHRoZXNlIGFuZCB0aGlzDQo+IGZ1bmN0aW9uIGNhbiBiZSBncmVhdGx5IHNpbXBsaWZpZWQuICBZ
b3VyIGNhbGwuIDopDQo+IA0KPiA+ICsgICAgICAgIHBhc2lkID0gVlREX1ZDTURfUEFTSURfVkFM
VUUodmFsKTsNCj4gPiArICAgICAgICByZXQgPSB2dGRfcmVxdWVzdF9wYXNpZF9mcmVlKHMsIHBh
c2lkKTsNCj4gPiArICAgICAgICBpZiAocmV0IDwgMCkgew0KPiA+ICsgICAgICAgICAgICBzLT52
Y3JzcCB8PSBWVERfVkNSU1BfU0MoVlREX1ZDTURfRlJFRV9JTlZBTElEX1BBU0lEKTsNCj4gPiAr
ICAgICAgICB9DQo+ID4gKyAgICAgICAgcy0+dmNyc3AgJj0gKH4oKHVpbnQ2NF90KSgweDEpKSk7
DQo+ID4gKyAgICAgICAgdnRkX3NldF9xdWFkX3JhdyhzLCBETUFSX1ZDUlNQX1JFRywNCj4gPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgICgodWludDY0X3QpIHMtPnZjcnNwKSk7DQo+ID4gKyAg
ICAgICAgYnJlYWs7DQo+ID4gKw0KPiA+ICsgICAgZGVmYXVsdDoNCj4gPiArICAgICAgICBzLT52
Y3JzcCB8PSBWVERfVkNSU1BfU0MoVlREX1ZDTURfVU5ERUZJTkVEX0NNRCk7DQo+IA0KPiAoSU1I
TyB5b3UgY2FuIHNpbXBseSBkbyBzL3w9Lz0vIGhlcmUgaWYgeW91IGhhbmRsZSBJUCB3ZWxsIGF0
IHRoZQ0KPiAgZW50cnkgb2YgdGhlIGZ1bmN0aW9uKQ0KPiANCj4gPiArICAgICAgICB2dGRfc2V0
X3F1YWRfcmF3KHMsIERNQVJfVkNSU1BfUkVHLA0KPiA+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgKCh1aW50NjRfdCkgcy0+dmNyc3ApKTsNCj4gPiArICAgICAgICBwcmludGYoIlZpcnR1YWwg
Q29tbWFuZDogdW5zdXBwb3J0ZWQgY29tbWFuZCEhIVxuIik7DQo+ID4gKyAgICAgICAgYnJlYWs7
DQo+ID4gKyAgICB9DQo+ID4gK30NCj4gPiArDQo+ID4gIHN0YXRpYyB1aW50NjRfdCB2dGRfbWVt
X3JlYWQodm9pZCAqb3BhcXVlLCBod2FkZHIgYWRkciwgdW5zaWduZWQgc2l6ZSkNCj4gPiAgew0K
PiA+ICAgICAgSW50ZWxJT01NVVN0YXRlICpzID0gb3BhcXVlOw0KPiA+IEBAIC0yNjIwLDYgKzI3
MjUsMTUgQEAgc3RhdGljIHVpbnQ2NF90IHZ0ZF9tZW1fcmVhZCh2b2lkICpvcGFxdWUsIGh3YWRk
cg0KPiBhZGRyLCB1bnNpZ25lZCBzaXplKQ0KPiA+ICAgICAgICAgIHZhbCA9IHMtPmlxID4+IDMy
Ow0KPiA+ICAgICAgICAgIGJyZWFrOw0KPiA+DQo+ID4gKyAgICBjYXNlIERNQVJfVkNSU1BfUkVH
Og0KPiA+ICsgICAgICAgIHZhbCA9IHMtPnZjcnNwOw0KPiA+ICsgICAgICAgIGJyZWFrOw0KPiA+
ICsNCj4gPiArICAgIGNhc2UgRE1BUl9WQ1JTUF9SRUdfSEk6DQo+ID4gKyAgICAgICAgYXNzZXJ0
KHNpemUgPT0gNCk7DQo+ID4gKyAgICAgICAgdmFsID0gcy0+dmNyc3AgPj4gMzI7DQo+ID4gKyAg
ICAgICAgYnJlYWs7DQo+IA0KPiBJZiB5b3UncmUgYWx3YXlzIHdpdGggdnRkX3NldF9xdWFkX3Jh
dygpcyB0aGVuIElNSE8geW91IGNhbiBkcm9wIHRoZXNlDQo+IGxpbmVzPyAgdnRkX21lbV9yZWFk
KCkgaGFzIGEgZGVmYXVsdCB0byBoYW5kbGUgYWxsIHRoZXNlLg0KDQphaGEsIHllcy4gbmljZSBz
dWdnZXN0aW9uLg0KDQo+ID4gKw0KPiA+ICAgICAgZGVmYXVsdDoNCj4gPiAgICAgICAgICBpZiAo
c2l6ZSA9PSA0KSB7DQo+ID4gICAgICAgICAgICAgIHZhbCA9IHZ0ZF9nZXRfbG9uZyhzLCBhZGRy
KTsNCj4gPiBAQCAtMjg2OCw2ICsyOTgyLDIxIEBAIHN0YXRpYyB2b2lkIHZ0ZF9tZW1fd3JpdGUo
dm9pZCAqb3BhcXVlLCBod2FkZHIgYWRkciwNCj4gPiAgICAgICAgICB2dGRfc2V0X2xvbmcocywg
YWRkciwgdmFsKTsNCj4gPiAgICAgICAgICBicmVhazsNCj4gPg0KPiA+ICsgICAgY2FzZSBETUFS
X1ZDTURfUkVHOg0KPiA+ICsgICAgICAgIGlmIChzaXplID09IDQpIHsNCj4gPiArICAgICAgICAg
ICAgdnRkX3NldF9sb25nKHMsIGFkZHIsIHZhbCk7DQo+ID4gKyAgICAgICAgfSBlbHNlIHsNCj4g
PiArICAgICAgICAgICAgdnRkX3NldF9xdWFkKHMsIGFkZHIsIHZhbCk7DQo+ID4gKyAgICAgICAg
fQ0KPiA+ICsgICAgICAgIHZ0ZF9oYW5kbGVfdmNtZF93cml0ZShzKTsNCj4gDQo+IElNSE8geW91
IHNob3VsZCBkbyB2dGRfaGFuZGxlX3ZjbWRfd3JpdGUoKSBmaXJzdCBhbmQgbGV0IGl0IHJldHVy
biBhDQo+IHZhbHVlLCB3aGVuIHJldHVybmluZyB0cnVlIHlvdSB1cGRhdGUgdGhlIHJlZ2lzZXJz
IHVzaW5nIHZ0ZF9zZXRfKigpDQo+IG90aGVyd2lzZSB5b3Ugc2hvdWxkIHNraXAgKGUuZy4sIHdo
ZW4gSVAgaXMgc2V0IGluIHZjbWQgcmVzdWx0IHJlZykuDQoNCkdvb2QuIExldCBtZSByZWZpbmUg
dGhlIGxvZ2ljIGhlcmUuDQoNCj4gPiArICAgICAgICBicmVhazsNCj4gPiArDQo+ID4gKyAgICBj
YXNlIERNQVJfVkNNRF9SRUdfSEk6DQo+ID4gKyAgICAgICAgYXNzZXJ0KHNpemUgPT0gNCk7DQo+
ID4gKyAgICAgICAgdnRkX3NldF9sb25nKHMsIGFkZHIsIHZhbCk7DQo+ID4gKyAgICAgICAgdnRk
X2hhbmRsZV92Y21kX3dyaXRlKHMpOw0KPiANCj4gU2FtZSBoZXJlPw0KDQpBY2NlcHRlZC4NCg0K
PiA+ICsgICAgICAgIGJyZWFrOw0KPiA+ICsNCj4gPiAgICAgIGRlZmF1bHQ6DQo+ID4gICAgICAg
ICAgaWYgKHNpemUgPT0gNCkgew0KPiA+ICAgICAgICAgICAgICB2dGRfc2V0X2xvbmcocywgYWRk
ciwgdmFsKTsNCj4gPiBAQCAtMzU3OSw3ICszNzA4LDggQEAgc3RhdGljIHZvaWQgdnRkX2luaXQo
SW50ZWxJT01NVVN0YXRlICpzKQ0KPiA+ICAgICAgICAgICAgICBzLT5lY2FwIHw9IFZURF9FQ0FQ
X1NNVFMgfCBWVERfRUNBUF9TUlMgfCBWVERfRUNBUF9TTFRTOw0KPiA+ICAgICAgICAgIH0gZWxz
ZSBpZiAoIXN0cmNtcChzLT5zbV9tb2RlbCwgInNjYWxhYmxlIikpIHsNCj4gPiAgICAgICAgICAg
ICAgcy0+ZWNhcCB8PSBWVERfRUNBUF9TTVRTIHwgVlREX0VDQVBfU1JTIHwgVlREX0VDQVBfUEFT
SUQNCj4gPiAtICAgICAgICAgICAgICAgICAgICAgICB8IFZURF9FQ0FQX0ZMVFM7DQo+ID4gKyAg
ICAgICAgICAgICAgICAgICAgICAgfCBWVERfRUNBUF9GTFRTIHwgVlREX0VDQVBfVkNTOw0KPiA+
ICsgICAgICAgICAgICBzLT52Y2NhcCB8PSBWVERfVkNDQVBfUEFTOw0KPiA+ICAgICAgICAgIH0g
ZWxzZSB7DQo+ID4gICAgICAgICAgICAgIHByaW50ZigiXG4hISEhISBJbnZhbGlkIHNtX21vZGVs
IGNvbmZpZyAhISEhIVxuIg0KPiA+ICAgICAgICAgICAgICAgICAgIlBsZWFzZSBjb25maWcgc21f
bW9kZWw9W1wibGVnYWN5XCJ8XCJzY2FsYWJsZVwiXVxuIg0KPiA+IEBAIC0zNjQxLDYgKzM3NzEs
MTMgQEAgc3RhdGljIHZvaWQgdnRkX2luaXQoSW50ZWxJT01NVVN0YXRlICpzKQ0KPiA+ICAgICAg
ICogSW50ZXJydXB0IHJlbWFwcGluZyByZWdpc3RlcnMuDQo+ID4gICAgICAgKi8NCj4gPiAgICAg
IHZ0ZF9kZWZpbmVfcXVhZChzLCBETUFSX0lSVEFfUkVHLCAwLCAweGZmZmZmZmZmZmZmZmY4MGZV
TEwsIDApOw0KPiA+ICsNCj4gPiArICAgIC8qDQo+ID4gKyAgICAgKiBWaXJ0dWFsIENvbW1hbmQg
RGVmaW5pdGlvbnMNCj4gPiArICAgICAqLw0KPiA+ICsgICAgdnRkX2RlZmluZV9xdWFkKHMsIERN
QVJfVkNDQVBfUkVHLCBzLT52Y2NhcCwgMCwgMCk7DQo+ID4gKyAgICB2dGRfZGVmaW5lX3F1YWQo
cywgRE1BUl9WQ01EX1JFRywgMCwgMHhmZmZmZmZmZmZmZmZmZmZmVUxMLCAwKTsNCj4gPiArICAg
IHZ0ZF9kZWZpbmVfcXVhZChzLCBETUFSX1ZDUlNQX1JFRywgMCwgMCwgMCk7DQo+ID4gIH0NCj4g
Pg0KPiA+ICAvKiBTaG91bGQgbm90IHJlc2V0IGFkZHJlc3Nfc3BhY2VzIHdoZW4gcmVzZXQgYmVj
YXVzZSBkZXZpY2VzIHdpbGwgc3RpbGwgdXNlDQo+ID4gZGlmZiAtLWdpdCBhL2h3L2kzODYvaW50
ZWxfaW9tbXVfaW50ZXJuYWwuaCBiL2h3L2kzODYvaW50ZWxfaW9tbXVfaW50ZXJuYWwuaA0KPiA+
IGluZGV4IGFkYWUxOTguLmY1YTJmMGQgMTAwNjQ0DQo+ID4gLS0tIGEvaHcvaTM4Ni9pbnRlbF9p
b21tdV9pbnRlcm5hbC5oDQo+ID4gKysrIGIvaHcvaTM4Ni9pbnRlbF9pb21tdV9pbnRlcm5hbC5o
DQo+ID4gQEAgLTg1LDYgKzg1LDEyIEBADQo+ID4gICNkZWZpbmUgRE1BUl9NVFJSQ0FQX1JFR19I
SSAgICAgMHgxMDQNCj4gPiAgI2RlZmluZSBETUFSX01UUlJERUZfUkVHICAgICAgICAweDEwOCAv
KiBNVFJSIGRlZmF1bHQgdHlwZSAqLw0KPiA+ICAjZGVmaW5lIERNQVJfTVRSUkRFRl9SRUdfSEkg
ICAgIDB4MTBjDQo+ID4gKyNkZWZpbmUgRE1BUl9WQ0NBUF9SRUcgICAgICAgICAgMHhFMDAgLyog
VmlydHVhbCBDb21tYW5kIENhcGFiaWxpdHkgUmVnaXN0ZXIgKi8NCj4gPiArI2RlZmluZSBETUFS
X1ZDQ0FQX1JFR19ISSAgICAgICAweEUwNA0KPiA+ICsjZGVmaW5lIERNQVJfVkNNRF9SRUcgICAg
ICAgICAgIDB4RTEwIC8qIFZpcnR1YWwgQ29tbWFuZCBSZWdpc3RlciAqLw0KPiA+ICsjZGVmaW5l
IERNQVJfVkNNRF9SRUdfSEkgICAgICAgIDB4RTE0DQo+ID4gKyNkZWZpbmUgRE1BUl9WQ1JTUF9S
RUcgICAgICAgICAgMHhFMjAgLyogVmlydHVhbCBDb21tYW5kIFJlcG9uc2UgUmVnaXN0ZXIgKi8N
Cj4gPiArI2RlZmluZSBETUFSX1ZDUlNQX1JFR19ISSAgICAgICAweEUyNA0KPiA+DQo+ID4gIC8q
IElPVExCIHJlZ2lzdGVycyAqLw0KPiA+ICAjZGVmaW5lIERNQVJfSU9UTEJfUkVHX09GRlNFVCAg
IDB4ZjAgLyogT2Zmc2V0IHRvIHRoZSBJT1RMQiByZWdpc3RlcnMgKi8NCj4gPiBAQCAtMTkyLDYg
KzE5OCw3IEBADQo+ID4gICNkZWZpbmUgVlREX0VDQVBfU1JTICAgICAgICAgICAgICAgICgxVUxM
IDw8IDMxKQ0KPiA+ICAjZGVmaW5lIFZURF9FQ0FQX1BBU0lEICAgICAgICAgICAgICAoMVVMTCA8
PCA0MCkNCj4gPiAgI2RlZmluZSBWVERfRUNBUF9TTVRTICAgICAgICAgICAgICAgKDFVTEwgPDwg
NDMpDQo+ID4gKyNkZWZpbmUgVlREX0VDQVBfVkNTICAgICAgICAgICAgICAgICgxVUxMIDw8IDQ0
KQ0KPiA+ICAjZGVmaW5lIFZURF9FQ0FQX1NMVFMgICAgICAgICAgICAgICAoMVVMTCA8PCA0NikN
Cj4gPiAgI2RlZmluZSBWVERfRUNBUF9GTFRTICAgICAgICAgICAgICAgKDFVTEwgPDwgNDcpDQo+
ID4NCj4gPiBAQCAtMzE0LDYgKzMyMSwyOSBAQCB0eXBlZGVmIGVudW0gVlRERmF1bHRSZWFzb24g
ew0KPiA+DQo+ID4gICNkZWZpbmUgVlREX0NPTlRFWFRfQ0FDSEVfR0VOX01BWCAgICAgICAweGZm
ZmZmZmZmVUwNCj4gPg0KPiA+ICsvKiBWQ0NBUF9SRUcgKi8NCj4gPiArI2RlZmluZSBWVERfVkND
QVBfUEFTICAgICAgICAgICAgICAgKDFVTCA8PCAwKQ0KPiA+ICsjZGVmaW5lIFZURF9NSU5fSFBB
U0lEICAgICAgICAgICAgICAyMDANCj4gDQo+IENvbW1lbnQgdGhpcyB2YWx1ZSBhIGJpdD8NCg0K
VGhlIGJhc2ljIGlkZWEgaXMgdG8gbGV0IGh5cGVydmlzb3IgdG8gc2V0IGEgcmFuZ2UgZm9yIGF2
YWlsYWJsZSBQQVNJRHMgZm9yDQpWTXMuIE9uZSBvZiB0aGUgcmVhc29ucyBpcyBQQVNJRCAjMCBp
cyByZXNlcnZlZCBieSBSSURfUEFTSUQgdXNhZ2UuDQpXZSBoYXZlIG5vIGlkZWEgaG93IG1hbnkg
cmVzZXJ2ZWQgUEFTSURzIGluIGZ1dHVyZSwgc28gaGVyZSBqdXN0IGENCmV2YWx1YXRlZCB2YWx1
ZS4gSG9uZXN0bHksIHNldCBpdCBhcyAiMSIgaXMgZW5vdWdoIGF0IGN1cnJlbnQgc3RhZ2UuDQoN
Cj4gPiArI2RlZmluZSBWVERfTUFYX0hQQVNJRCAgICAgICAgICAgICAgMHhGRkZGRg0KPiA+ICsN
Cj4gPiArLyogVmlydHVhbCBDb21tYW5kIFJlZ2lzdGVyICovDQo+ID4gK2VudW0gew0KPiA+ICsg
ICAgIFZURF9WQ01EX05VTExfQ01EID0gMCwNCj4gPiArICAgICBWVERfVkNNRF9BTExPQ19QQVNJ
RCwNCj4gDQo+IFNoYWxsIHdlIHNwZWxsICIgPSAxIiBleHBsaWNpdGx5IGlmIGRlZmluZWQgaW4g
c3BlYz8NCg0KeWVzLCBpdCBpcy4NCg0KPiA+ICsgICAgIFZURF9WQ01EX0ZSRUVfUEFTSUQsDQo+
IA0KPiBTYW1lIGhlcmUuDQoNCkFjY2VwdGVkLg0KDQo+IA0KPiBSZWdhcmRzLA0KPiANCj4gLS0N
Cj4gUGV0ZXIgWHUNCg0KVGhhbmtzLA0KWWkgTGl1DQo=
