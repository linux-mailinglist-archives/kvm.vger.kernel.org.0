Return-Path: <kvm-owner@vger.kernel.org>
X-Original-To: lists+kvm@lfdr.de
Delivered-To: lists+kvm@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 749A34CB795
	for <lists+kvm@lfdr.de>; Thu,  3 Mar 2022 08:22:17 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S230081AbiCCHXA (ORCPT <rfc822;lists+kvm@lfdr.de>);
        Thu, 3 Mar 2022 02:23:00 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:53010 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S230150AbiCCHW4 (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 3 Mar 2022 02:22:56 -0500
Received: from ams.source.kernel.org (ams.source.kernel.org [IPv6:2604:1380:4601:e00::1])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 77C4F16BF93
        for <kvm@vger.kernel.org>; Wed,  2 Mar 2022 23:22:11 -0800 (PST)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by ams.source.kernel.org (Postfix) with ESMTPS id BEF17B81FEA
        for <kvm@vger.kernel.org>; Thu,  3 Mar 2022 07:22:09 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 47ECCC004E1;
        Thu,  3 Mar 2022 07:22:08 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1646292128;
        bh=MHIbLwgBAWMHdfUXELcmaCZb2HwLpKYYxXXvAGZ9g8U=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=tx85Tb8/8wjmNCZr/5woKYOrvIWfUwyr9FQdqVVEET1pCz3llX1ROF1z5B1AG0i9m
         WlSZbQCTSRmt1WFBlQ6sS1rStpnlSBmOV0T6oK52ZbbgwVwsdFSqXvH2qGSnZF/8Rk
         BI7Jv1yJVB7dCAU1utD0hSrR2aFHpjT3W7qNaMgEHF75j7vndZsJOaMPG06loggP48
         ed5N/f0DTvDOORvPssajmE23+IqC9T+u+8l5UWvMGHihAg+/imavx4Cq2jzCtjOyZv
         x9xBxUJjXFyljPbe2nr7Fi88c4hxUcvSGtdmdUbet4euTEBz107Fawv8PRE/8vGVMW
         yvbmZtV16uq9A==
Received: from ip-185-104-136-29.ptr.icomera.net ([185.104.136.29] helo=billy-the-mountain.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.94.2)
        (envelope-from <maz@kernel.org>)
        id 1nPfmn-00BtGo-F8; Thu, 03 Mar 2022 07:22:05 +0000
Date:   Thu, 03 Mar 2022 07:21:44 +0000
Message-ID: <87r17j5wmv.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Oliver Upton <oupton@google.com>
Cc:     kvmarm@lists.cs.columbia.edu, kvm@vger.kernel.org,
        James Morse <james.morse@arm.com>,
        Alexandru Elisei <alexandru.elisei@arm.com>,
        Suzuki K Poulose <suzuki.poulose@arm.com>,
        linux-arm-kernel@lists.infradead.org,
        Peter Shier <pshier@google.com>,
        Ricardo Koller <ricarkol@google.com>,
        Reiji Watanabe <reijiw@google.com>,
        Paolo Bonzini <pbonzini@redhat.com>
Subject: Re: [PATCH 1/2] Documentation: KVM: Update documentation to indicate KVM is arm64-only
In-Reply-To: <20220302194221.1774513-2-oupton@google.com>
References: <20220302194221.1774513-1-oupton@google.com>
        <20220302194221.1774513-2-oupton@google.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/27.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.104.136.29
X-SA-Exim-Rcpt-To: oupton@google.com, kvmarm@lists.cs.columbia.edu, kvm@vger.kernel.org, james.morse@arm.com, alexandru.elisei@arm.com, suzuki.poulose@arm.com, linux-arm-kernel@lists.infradead.org, pshier@google.com, ricarkol@google.com, reijiw@google.com, pbonzini@redhat.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
X-Spam-Status: No, score=-7.5 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_HI,
        SPF_HELO_NONE,SPF_PASS,T_SCC_BODY_TEXT_LINE autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org

Hi Oliver,

Thanks for taking the hint! :D A few remarks below.

On Wed, 02 Mar 2022 19:42:20 +0000,
Oliver Upton <oupton@google.com> wrote:
> 
> KVM support for 32-bit ARM hosts (KVM/arm) has been removed from the
> kernel since commit 541ad0150ca4 ("arm: Remove 32bit KVM host
> support"). There still exists some remnants of the old architecture in
> the KVM documentation.
> 
> Remove all traces of 32-bit host support from the documentation. Note
> that AArch32 guests are still supported.
> 
> Fixes: 541ad0150ca4 ("arm: Remove 32bit KVM host support")

TBH, I'd drop the Fixes. Otherwise, it is going to be dragged into
-stable versions, and generate a number of pointless conflicts.

> Suggested-by: Marc Zyngier <maz@kernel.org>
> Signed-off-by: Oliver Upton <oupton@google.com>
> ---
>  Documentation/virt/kvm/api.rst          | 83 ++++++++++++-------------
>  Documentation/virt/kvm/arm/hyp-abi.rst  | 54 ++++++++--------
>  Documentation/virt/kvm/arm/ptp_kvm.rst  |  4 +-
>  Documentation/virt/kvm/devices/vcpu.rst |  2 +-
>  4 files changed, 70 insertions(+), 73 deletions(-)
> 
> diff --git a/Documentation/virt/kvm/api.rst b/Documentation/virt/kvm/api.rst
> index 9f3172376ec3..25423ee890e2 100644
> --- a/Documentation/virt/kvm/api.rst
> +++ b/Documentation/virt/kvm/api.rst

This part looks good.

> diff --git a/Documentation/virt/kvm/arm/hyp-abi.rst b/Documentation/virt/kvm/arm/hyp-abi.rst
> index 4d43fbc25195..516ea630d160 100644
> --- a/Documentation/virt/kvm/arm/hyp-abi.rst
> +++ b/Documentation/virt/kvm/arm/hyp-abi.rst

The content of this file is, however, still valid. Despite KVM having
been removed, the 32bit kernel still supports being entered at HYP
(bootloaders such as u-boot will definitely do that), and still uses
this internal API to switch back to HYP on kexec. Other hypervisors
(such as jailhouse) also rely on this API to install themselves at
runtime.

> diff --git a/Documentation/virt/kvm/arm/ptp_kvm.rst b/Documentation/virt/kvm/arm/ptp_kvm.rst
> index aecdc80ddcd8..5d47f7ecbf5a 100644
> --- a/Documentation/virt/kvm/arm/ptp_kvm.rst
> +++ b/Documentation/virt/kvm/arm/ptp_kvm.rst
> @@ -1,7 +1,7 @@
>  .. SPDX-License-Identifier: GPL-2.0
>  
> -PTP_KVM support for arm/arm64
> -=============================
> +PTP_KVM support for arm64

This is a service that the arm64 hypervisor offers to guests,
including 32bit guests. It was actually merged after 32bit port was
removed. So this file should probably stay untouched, or be amended to
clarify the nuance in terms of support.

> +=========================
>  
>  PTP_KVM is used for high precision time sync between host and guests.
>  It relies on transferring the wall clock and counter value from the
> diff --git a/Documentation/virt/kvm/devices/vcpu.rst b/Documentation/virt/kvm/devices/vcpu.rst
> index 60a29972d3f1..92942440a9e7 100644
> --- a/Documentation/virt/kvm/devices/vcpu.rst
> +++ b/Documentation/virt/kvm/devices/vcpu.rst

This one is OK.

Thanks,

	M.

-- 
Without deviation from the norm, progress is not possible.
