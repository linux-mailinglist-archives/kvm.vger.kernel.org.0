Return-Path: <kvm+bounces-30952-lists+kvm=lfdr.de@vger.kernel.org>
X-Original-To: lists+kvm@lfdr.de
Delivered-To: lists+kvm@lfdr.de
Received: from am.mirrors.kernel.org (am.mirrors.kernel.org [147.75.80.249])
	by mail.lfdr.de (Postfix) with ESMTPS id 370009BEEFF
	for <lists+kvm@lfdr.de>; Wed,  6 Nov 2024 14:27:09 +0100 (CET)
Received: from smtp.subspace.kernel.org (wormhole.subspace.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by am.mirrors.kernel.org (Postfix) with ESMTPS id E16491F2499E
	for <lists+kvm@lfdr.de>; Wed,  6 Nov 2024 13:27:08 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id DB5F41DF995;
	Wed,  6 Nov 2024 13:27:01 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b="crHz1lLz"
X-Original-To: kvm@vger.kernel.org
Received: from smtp.kernel.org (aws-us-west-2-korg-mail-1.web.codeaurora.org [10.30.226.201])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 07424191461;
	Wed,  6 Nov 2024 13:27:00 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=10.30.226.201
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1730899621; cv=none; b=YIQEcLaY65JMQzHTUdRYIFD8e6Z5JXE31N3ly+3xj7H35qC7D9JPUitb+hzv6/YvOWWlSUvVCpmOMfQa8OU+YVepNifIjdbrxdTI1/Wel4fztHxJ7qCzQkI7iGFNn8lrY1Xjy2zSK+NZZg0EwfAhN/PC2aNUz5Wu/AlAUIiuUvI=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1730899621; c=relaxed/simple;
	bh=YsdgsNLn3Pt94qYHQp37MqqUXQnx1YcTHDZKk+avfN0=;
	h=Date:Message-ID:From:To:Cc:Subject:In-Reply-To:References:
	 MIME-Version:Content-Type; b=MxSqh1Uz4AC+XP/p8OpcaU9U9fKP2zi2uz+aDhrZEAmXJUnxpSSqmCIuXtmtnnV1QpvwVv8M+31BIyBb3PseZbE8OPmMpz2pkZYrOjvPVtDy2uyBQMuSunMxD9R7Lnxus/GxtQQSs62QYO7ePuIQZM8YZaVYq5Is0coNiwWfbN8=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b=crHz1lLz; arc=none smtp.client-ip=10.30.226.201
Received: by smtp.kernel.org (Postfix) with ESMTPSA id BE1B1C4CECD;
	Wed,  6 Nov 2024 13:27:00 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1730899620;
	bh=YsdgsNLn3Pt94qYHQp37MqqUXQnx1YcTHDZKk+avfN0=;
	h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
	b=crHz1lLzZMb7i/uvSwBbyrGkEUN8bOUEZEnF9f8JAwv8cUCLPO+mWcZsYhF7bHFx/
	 JQGwm2lV7eH7Of+HF0L5wXqRLQamQIITuhJMsiJH6aLlD0FpEJ8IGRAfhBmS5Y0CGC
	 6lL4zO2okkyEXHXDeXcc2k8qekasXR64FcOHbsTTATUzZN1j9Klhu+2w1AjkUE9LmB
	 ZJ3spHnXLMLVVIgzAaAepFVtxWcsaysfPq4Wk6O8+t+PKyHSHPkLzAUtnozE/QEtYw
	 vAN/FkdjSxaCIuOZ5LEaPRMSMKfw52Fr+q58DGdNuieJhtdAlw7NdZI4s/mRAiyNTa
	 1rVbDV1ANxMkQ==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
	by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
	(Exim 4.95)
	(envelope-from <maz@kernel.org>)
	id 1t8g3m-00ANoh-KU;
	Wed, 06 Nov 2024 13:26:58 +0000
Date: Wed, 06 Nov 2024 13:26:57 +0000
Message-ID: <86a5ec1oim.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Jing Zhang <jingzhangos@google.com>
Cc: KVM <kvm@vger.kernel.org>,
	KVMARM <kvmarm@lists.linux.dev>,
	ARMLinux <linux-arm-kernel@lists.infradead.org>,
	Oliver Upton <oupton@google.com>,
	Joey Gouly <joey.gouly@arm.com>,
	Zenghui Yu <yuzenghui@huawei.com>,
	Suzuki K Poulose <suzuki.poulose@arm.com>,
	Kunkun Jiang <jiangkunkun@huawei.com>,
	Paolo Bonzini <pbonzini@redhat.com>,
	Andre Przywara <andre.przywara@arm.com>,
	Colton Lewis <coltonlewis@google.com>,
	Raghavendra Rao Ananta <rananta@google.com>,
	Shusen Li <lishusen2@huawei.com>,
	Eric Auger <eauger@redhat.com>
Subject: Re: [PATCH v3 4/4] KVM: selftests: aarch64: Test VGIC ITS tables save/restore
In-Reply-To: <20241106083035.2813799-5-jingzhangos@google.com>
References: <20241106083035.2813799-1-jingzhangos@google.com>
	<20241106083035.2813799-5-jingzhangos@google.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/29.4
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Precedence: bulk
X-Mailing-List: kvm@vger.kernel.org
List-Id: <kvm.vger.kernel.org>
List-Subscribe: <mailto:kvm+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:kvm+unsubscribe@vger.kernel.org>
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: quoted-printable
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: jingzhangos@google.com, kvm@vger.kernel.org, kvmarm@lists.linux.dev, linux-arm-kernel@lists.infradead.org, oupton@google.com, joey.gouly@arm.com, yuzenghui@huawei.com, suzuki.poulose@arm.com, jiangkunkun@huawei.com, pbonzini@redhat.com, andre.przywara@arm.com, coltonlewis@google.com, rananta@google.com, lishusen2@huawei.com, eauger@redhat.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false

[Adding Eric to the list, since he worked a lot on the save/restore code]

On Wed, 06 Nov 2024 08:30:35 +0000,
Jing Zhang <jingzhangos@google.com> wrote:
>=20
> Add a selftest to verify the correctness of the VGIC ITS mappings after
> the save/restore operations (KVM_DEV_ARM_ITS_SAVE_TABLES /
> KVM_DEV_ARM_ITS_RESTORE_TABLES).

What are you checking? The saved data? The restored data?

> Also calculate the time spending on save/restore operations.

Is that really relevant? I don't think performance matters at this
stage, if we can't even have reliable data.

> This test uses some corner cases to capture the save/restore bugs. It

Which corner cases?

> will be used to verify the future incoming changes for the VGIC ITS
> tables save/restore.
>=20
> To capture the "Invalid argument (-22)" error, run the test without any
> option. To capture the wrong/lost mappings, run the test with '-s'
> option.
> Since the VGIC ITS save/restore bug is caused by orphaned DTE/ITE
> entries, if we run the test with '-c' option whih clears the tables
> before the save operation, the test will complete successfully.

I'm sorry, but this description is meaningless, as you need to know
what is the bug that has been fixed.

Also, how is someone supposed to run this thing? Without options? With
options? With any combination of options?

=46rom what I understand, the various options are designed to help
debugging a broken vgic implementation. So please document what the
options do rather than an bug that is supposed to be already fixed.

Thanks,

	M.

--=20
Without deviation from the norm, progress is not possible.

