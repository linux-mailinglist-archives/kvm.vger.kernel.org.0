Return-Path: <kvm-owner@vger.kernel.org>
X-Original-To: lists+kvm@lfdr.de
Delivered-To: lists+kvm@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id DC1E13D0CBE
	for <lists+kvm@lfdr.de>; Wed, 21 Jul 2021 13:09:31 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S238302AbhGUJn5 (ORCPT <rfc822;lists+kvm@lfdr.de>);
        Wed, 21 Jul 2021 05:43:57 -0400
Received: from mail.kernel.org ([198.145.29.99]:43468 "EHLO mail.kernel.org"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S238344AbhGUJND (ORCPT <rfc822;kvm@vger.kernel.org>);
        Wed, 21 Jul 2021 05:13:03 -0400
Received: from disco-boy.misterjones.org (disco-boy.misterjones.org [51.254.78.96])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by mail.kernel.org (Postfix) with ESMTPSA id 03EEC60FDA;
        Wed, 21 Jul 2021 09:53:40 +0000 (UTC)
Received: from sofa.misterjones.org ([185.219.108.64] helo=why.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.94.2)
        (envelope-from <maz@kernel.org>)
        id 1m68v3-00Efzw-VK; Wed, 21 Jul 2021 10:53:38 +0100
Date:   Wed, 21 Jul 2021 10:53:37 +0100
Message-ID: <87czrc2dsu.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Jianyong Wu <jianyong.wu@arm.com>
Cc:     james.morse@arm.com, andre.przywara@arm.com, lushenming@huawei.com,
        kvm@vger.kernel.org, kvmarm@lists.cs.columbia.edu,
        linux-doc@vger.kernel.org, linux-kernel@vger.kernel.org,
        justin.he@arm.com
Subject: Re: [PATCH] doc/arm: take care restore order of GICR_* in ITS restore
In-Reply-To: <20210721092019.144088-1-jianyong.wu@arm.com>
References: <20210721092019.144088-1-jianyong.wu@arm.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/27.1
 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: jianyong.wu@arm.com, james.morse@arm.com, andre.przywara@arm.com, lushenming@huawei.com, kvm@vger.kernel.org, kvmarm@lists.cs.columbia.edu, linux-doc@vger.kernel.org, linux-kernel@vger.kernel.org, justin.he@arm.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org

On Wed, 21 Jul 2021 10:20:19 +0100,
Jianyong Wu <jianyong.wu@arm.com> wrote:
> 
> When restore GIC/ITS, GICR_CTLR must be restored after GICR_PROPBASER
> and GICR_PENDBASER. That is important, as both of GICR_PROPBASER and
> GICR_PENDBASER will fail to be loaded when lpi has enabled yet in
> GICR_CTLR. Keep the restore order above will avoid that issue.
> Shout it out at the doc is very helpful that may avoid lots of debug work.

But that's something that is already mandated by the architecture,
isn't it? See "5.1 LPIs" in the architecture spec:

<quote>

If GICR_PROPBASER is updated when GICR_CTLR.EnableLPIs == 1, the
effects are UNPREDICTABLE.

[...]

If GICR_PENDBASER is updated when GICR_CTLR.EnableLPIs == 1, the
effects are UNPREDICTABLE.

</quote>

The point of this documentation is to make it explicit what is *not*
covered by the architecture. Anything that is in the architecture
still applies, and shouldn't be overlooked.

Thanks,

	M.

-- 
Without deviation from the norm, progress is not possible.
