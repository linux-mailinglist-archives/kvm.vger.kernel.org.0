Return-Path: <kvm+bounces-2273-lists+kvm=lfdr.de@vger.kernel.org>
X-Original-To: lists+kvm@lfdr.de
Delivered-To: lists+kvm@lfdr.de
Received: from sv.mirrors.kernel.org (sv.mirrors.kernel.org [IPv6:2604:1380:45e3:2400::1])
	by mail.lfdr.de (Postfix) with ESMTPS id C49817F44FE
	for <lists+kvm@lfdr.de>; Wed, 22 Nov 2023 12:39:50 +0100 (CET)
Received: from smtp.subspace.kernel.org (wormhole.subspace.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by sv.mirrors.kernel.org (Postfix) with ESMTPS id 80B872815BA
	for <lists+kvm@lfdr.de>; Wed, 22 Nov 2023 11:39:49 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id DC935584E2;
	Wed, 22 Nov 2023 11:39:45 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b="sItovUyH"
X-Original-To: kvm@vger.kernel.org
Received: from smtp.kernel.org (aws-us-west-2-korg-mail-1.web.codeaurora.org [10.30.226.201])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id B87012914;
	Wed, 22 Nov 2023 11:39:44 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 3751DC433B9;
	Wed, 22 Nov 2023 11:39:44 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1700653184;
	bh=E4WcJC/nUGJW251PN1xEvRw6wmxZO7AcExQa/hcdZ9Y=;
	h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
	b=sItovUyHAWRnorRBtfLW/nCA5/Wo8wxv9VwqsPeoxkSIcUlkfelQ5axCpLqDszdO3
	 k05vIircJHuElIGFDQsuYAzZjw4NMsa3cGpFu6D8WtQVcscbfcIwi8YB+F1GdDl6BM
	 zwtPr1z+NEvd1a8lfwzPaRtNWpwGyrMaBvMYFP3iCQbXrMC6mfrCDniuCgMprxl+me
	 Lo6vU14gbq0CVnM/K5j+wJ6SccrTf33zckeNjnuN7lSdBcPj+V/m5m50t04PNd6mSA
	 q4+GwoJpqIlNd0Y3JrLsIe/nfYy2UujqOChV7Io8TVYDJYIHSG54c2HbAEq9WYSuQP
	 sXwhMmh3t15FQ==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
	by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
	(Exim 4.95)
	(envelope-from <maz@kernel.org>)
	id 1r5la1-00FPOL-JL;
	Wed, 22 Nov 2023 11:39:41 +0000
Date: Wed, 22 Nov 2023 11:39:41 +0000
Message-ID: <86jzqayq2q.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Ganapatrao Kulkarni <gankulkarni@os.amperecomputing.com>
Cc: kvmarm@lists.linux.dev,
	kvm@vger.kernel.org,
	linux-arm-kernel@lists.infradead.org,
	Alexandru Elisei <alexandru.elisei@arm.com>,
	Andre Przywara <andre.przywara@arm.com>,
	Chase Conklin <chase.conklin@arm.com>,
	Christoffer Dall <christoffer.dall@arm.com>,
	Darren Hart <darren@os.amperecomputing.com>,
	Jintack Lim <jintack@cs.columbia.edu>,
	Russell King <rmk+kernel@armlinux.org.uk>,
	Miguel Luis <miguel.luis@oracle.com>,
	James Morse <james.morse@arm.com>,
	Suzuki K Poulose <suzuki.poulose@arm.com>,
	Oliver Upton <oliver.upton@linux.dev>,
	Zenghui Yu <yuzenghui@huawei.com>
Subject: Re: [PATCH v11 00/43] KVM: arm64: Nested Virtualization support (FEAT_NV2 only)
In-Reply-To: <64cdd9ea-fc7b-4108-a896-43b16eef1553@os.amperecomputing.com>
References: <20231120131027.854038-1-maz@kernel.org>
	<a44660c4-e43a-4663-94c0-9b290ea755e3@os.amperecomputing.com>
	<86ttpfzd5k.wl-maz@kernel.org>
	<67082409-f432-44b6-bf40-1af9b4b7b569@os.amperecomputing.com>
	<86r0kjzbnq.wl-maz@kernel.org>
	<64cdd9ea-fc7b-4108-a896-43b16eef1553@os.amperecomputing.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/29.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Precedence: bulk
X-Mailing-List: kvm@vger.kernel.org
List-Id: <kvm.vger.kernel.org>
List-Subscribe: <mailto:kvm+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:kvm+unsubscribe@vger.kernel.org>
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: gankulkarni@os.amperecomputing.com, kvmarm@lists.linux.dev, kvm@vger.kernel.org, linux-arm-kernel@lists.infradead.org, alexandru.elisei@arm.com, andre.przywara@arm.com, chase.conklin@arm.com, christoffer.dall@arm.com, darren@os.amperecomputing.com, jintack@cs.columbia.edu, rmk+kernel@armlinux.org.uk, miguel.luis@oracle.com, james.morse@arm.com, suzuki.poulose@arm.com, oliver.upton@linux.dev, yuzenghui@huawei.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false

On Wed, 22 Nov 2023 11:10:10 +0000,
Ganapatrao Kulkarni <gankulkarni@os.amperecomputing.com> wrote:
> 
> 
> No change, still L1 hangs. Captured ftrace and the L1 is keep
> looping/faulting around same address across kvm_entry and kvm_exits.
> 
> It is a weird behavior, L1 is faulting and looping around MDCR and
> AA64MMFR3_EL1 access in function __finalise_el2.

I really can't see how this happens. There are no backward branches,
and we don't seem to reach the ERET either. So something must affect
the state after the trap of ID_AA64MMFR3_EL1.

	M.

-- 
Without deviation from the norm, progress is not possible.

