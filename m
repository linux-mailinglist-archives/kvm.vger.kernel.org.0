Return-Path: <kvm-owner@vger.kernel.org>
X-Original-To: lists+kvm@lfdr.de
Delivered-To: lists+kvm@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id EEBDAF0E87
	for <lists+kvm@lfdr.de>; Wed,  6 Nov 2019 06:55:26 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1725828AbfKFFzZ (ORCPT <rfc822;lists+kvm@lfdr.de>);
        Wed, 6 Nov 2019 00:55:25 -0500
Received: from mga05.intel.com ([192.55.52.43]:31173 "EHLO mga05.intel.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1725616AbfKFFzZ (ORCPT <rfc822;kvm@vger.kernel.org>);
        Wed, 6 Nov 2019 00:55:25 -0500
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
  by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 05 Nov 2019 21:55:24 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,272,1569308400"; 
   d="scan'208";a="205222652"
Received: from fmsmsx107.amr.corp.intel.com ([10.18.124.205])
  by orsmga003.jf.intel.com with ESMTP; 05 Nov 2019 21:55:23 -0800
Received: from shsmsx154.ccr.corp.intel.com (10.239.6.54) by
 fmsmsx107.amr.corp.intel.com (10.18.124.205) with Microsoft SMTP Server (TLS)
 id 14.3.439.0; Tue, 5 Nov 2019 21:55:22 -0800
Received: from shsmsx104.ccr.corp.intel.com ([169.254.5.127]) by
 SHSMSX154.ccr.corp.intel.com ([169.254.7.200]) with mapi id 14.03.0439.000;
 Wed, 6 Nov 2019 13:55:21 +0800
From:   "Liu, Yi L" <yi.l.liu@intel.com>
To:     Peter Xu <peterx@redhat.com>
CC:     "qemu-devel@nongnu.org" <qemu-devel@nongnu.org>,
        "mst@redhat.com" <mst@redhat.com>,
        "pbonzini@redhat.com" <pbonzini@redhat.com>,
        "alex.williamson@redhat.com" <alex.williamson@redhat.com>,
        "eric.auger@redhat.com" <eric.auger@redhat.com>,
        "david@gibson.dropbear.id.au" <david@gibson.dropbear.id.au>,
        "Tian, Kevin" <kevin.tian@intel.com>,
        "Tian, Jun J" <jun.j.tian@intel.com>,
        "Sun, Yi Y" <yi.y.sun@intel.com>,
        "jacob.jun.pan@linux.intel.com" <jacob.jun.pan@linux.intel.com>,
        "kvm@vger.kernel.org" <kvm@vger.kernel.org>,
        Yi Sun <yi.y.sun@linux.intel.com>
Subject: RE: [RFC v2 11/22] intel_iommu: process pasid cache invalidation
Thread-Topic: [RFC v2 11/22] intel_iommu: process pasid cache invalidation
Thread-Index: AQHVims0gnJtva3dYk2Lhkg1plkVR6d3k9OAgATO/oA=
Date:   Wed, 6 Nov 2019 05:55:20 +0000
Message-ID: <A2975661238FB949B60364EF0F2C25743A0EEE4E@SHSMSX104.ccr.corp.intel.com>
References: <1571920483-3382-1-git-send-email-yi.l.liu@intel.com>
 <1571920483-3382-12-git-send-email-yi.l.liu@intel.com>
 <20191102160547.GA26023@xz-x1.metropole.lan>
In-Reply-To: <20191102160547.GA26023@xz-x1.metropole.lan>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
dlp-product: dlpe-windows
dlp-version: 11.2.0.6
dlp-reaction: no-action
x-ctpclassification: CTP_NT
x-titus-metadata-40: eyJDYXRlZ29yeUxhYmVscyI6IiIsIk1ldGFkYXRhIjp7Im5zIjoiaHR0cDpcL1wvd3d3LnRpdHVzLmNvbVwvbnNcL0ludGVsMyIsImlkIjoiYjU5OGVkOWQtMzk2ZS00MDZmLTgzZTItZmM3ODI4N2RlNGJmIiwicHJvcHMiOlt7Im4iOiJDVFBDbGFzc2lmaWNhdGlvbiIsInZhbHMiOlt7InZhbHVlIjoiQ1RQX05UIn1dfV19LCJTdWJqZWN0TGFiZWxzIjpbXSwiVE1DVmVyc2lvbiI6IjE3LjEwLjE4MDQuNDkiLCJUcnVzdGVkTGFiZWxIYXNoIjoicklxV1BaQnNQSFhyWjFtYlwvd3dtUkV3R3dPam8zeThoRlBnWkRKQW9YZE1LRnhSRDRRXC85dkFmWnk0Uktzd0hYIn0=
x-originating-ip: [10.239.127.40]
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org

PiBGcm9tOiBQZXRlciBYdSBbbWFpbHRvOnBldGVyeEByZWRoYXQuY29tXQ0KPiBTZW50OiBTdW5k
YXksIE5vdmVtYmVyIDMsIDIwMTkgMTI6MDYgQU0NCj4gVG86IExpdSwgWWkgTCA8eWkubC5saXVA
aW50ZWwuY29tPg0KPiBTdWJqZWN0OiBSZTogW1JGQyB2MiAxMS8yMl0gaW50ZWxfaW9tbXU6IHBy
b2Nlc3MgcGFzaWQgY2FjaGUgaW52YWxpZGF0aW9uDQo+IA0KPiBPbiBUaHUsIE9jdCAyNCwgMjAx
OSBhdCAwODozNDozMkFNIC0wNDAwLCBMaXUgWWkgTCB3cm90ZToNCj4gPiBUaGlzIHBhdGNoIGFk
ZHMgUEFTSUQgY2FjaGUgaW52YWxpZGF0aW9uIGhhbmRsaW5nLiBXaGVuIGd1ZXN0IGVuYWJsZWQN
Cj4gPiBQQVNJRCB1c2FnZXMgKGUuZy4gU1ZBKSwgZ3Vlc3Qgc29mdHdhcmUgc2hvdWxkIGlzc3Vl
IGEgcHJvcGVyIFBBU0lEDQo+ID4gY2FjaGUgaW52YWxpZGF0aW9uIHdoZW4gY2FjaGluZy1tb2Rl
IGlzIGV4cG9zZWQuIFRoaXMgcGF0Y2ggb25seSBhZGRzDQo+ID4gdGhlIGRyYWZ0IGhhbmRsaW5n
IG9mIHBhc2lkIGNhY2hlIGludmFsaWRhdGlvbi4gRGV0YWlsZWQgaGFuZGxpbmcgd2lsbA0KPiA+
IGJlIGFkZGVkIGluIHN1YnNlcXVlbnQgcGF0Y2hlcy4NCj4gPg0KPiA+IENjOiBLZXZpbiBUaWFu
IDxrZXZpbi50aWFuQGludGVsLmNvbT4NCj4gPiBDYzogSmFjb2IgUGFuIDxqYWNvYi5qdW4ucGFu
QGxpbnV4LmludGVsLmNvbT4NCj4gPiBDYzogUGV0ZXIgWHUgPHBldGVyeEByZWRoYXQuY29tPg0K
PiA+IENjOiBZaSBTdW4gPHlpLnkuc3VuQGxpbnV4LmludGVsLmNvbT4NCj4gPiBTaWduZWQtb2Zm
LWJ5OiBMaXUgWWkgTCA8eWkubC5saXVAaW50ZWwuY29tPg0KPiA+IC0tLQ0KPiA+ICBody9pMzg2
L2ludGVsX2lvbW11LmMgICAgICAgICAgfCA2NiArKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKy0tDQo+IC0tDQo+ID4gIGh3L2kzODYvaW50ZWxfaW9tbXVfaW50ZXJuYWwuaCB8
IDEyICsrKysrKysrDQo+ID4gIGh3L2kzODYvdHJhY2UtZXZlbnRzICAgICAgICAgICB8ICAzICsr
DQo+ID4gIDMgZmlsZXMgY2hhbmdlZCwgNzYgaW5zZXJ0aW9ucygrKSwgNSBkZWxldGlvbnMoLSkN
Cj4gPg0KPiA+IGRpZmYgLS1naXQgYS9ody9pMzg2L2ludGVsX2lvbW11LmMgYi9ody9pMzg2L2lu
dGVsX2lvbW11LmMNCj4gPiBpbmRleCA4OGI4NDNmLi44NGZmNmYwIDEwMDY0NA0KPiA+IC0tLSBh
L2h3L2kzODYvaW50ZWxfaW9tbXUuYw0KPiA+ICsrKyBiL2h3L2kzODYvaW50ZWxfaW9tbXUuYw0K
PiA+IEBAIC0yMzM1LDYgKzIzMzUsNjMgQEAgc3RhdGljIGJvb2wgdnRkX3Byb2Nlc3NfaW90bGJf
ZGVzYyhJbnRlbElPTU1VU3RhdGUNCj4gKnMsIFZUREludkRlc2MgKmludl9kZXNjKQ0KPiA+ICAg
ICAgcmV0dXJuIHRydWU7DQo+ID4gIH0NCj4gPg0KPiA+ICtzdGF0aWMgaW50IHZ0ZF9wYXNpZF9j
YWNoZV9kc2koSW50ZWxJT01NVVN0YXRlICpzLCB1aW50MTZfdCBkb21haW5faWQpDQo+ID4gK3sN
Cj4gPiArICAgIHJldHVybiAwOw0KPiA+ICt9DQo+ID4gKw0KPiA+ICtzdGF0aWMgaW50IHZ0ZF9w
YXNpZF9jYWNoZV9wc2koSW50ZWxJT01NVVN0YXRlICpzLA0KPiA+ICsgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdWludDE2X3QgZG9tYWluX2lkLCB1aW50MzJfdCBwYXNpZCkNCj4gPiAr
ew0KPiA+ICsgICAgcmV0dXJuIDA7DQo+ID4gK30NCj4gPiArDQo+ID4gK3N0YXRpYyBpbnQgdnRk
X3Bhc2lkX2NhY2hlX2dzaShJbnRlbElPTU1VU3RhdGUgKnMpDQo+ID4gK3sNCj4gPiArICAgIHJl
dHVybiAwOw0KPiA+ICt9DQo+ID4gKw0KPiA+ICtzdGF0aWMgYm9vbCB2dGRfcHJvY2Vzc19wYXNp
ZF9kZXNjKEludGVsSU9NTVVTdGF0ZSAqcywNCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBWVERJbnZEZXNjICppbnZfZGVzYykNCj4gPiArew0KPiA+ICsgICAgdWludDE2
X3QgZG9tYWluX2lkOw0KPiA+ICsgICAgdWludDMyX3QgcGFzaWQ7DQo+ID4gKyAgICBpbnQgcmV0
ID0gMDsNCj4gPiArDQo+ID4gKyAgICBpZiAoKGludl9kZXNjLT52YWxbMF0gJiBWVERfSU5WX0RF
U0NfUEFTSURDX1JTVkRfVkFMMCkgfHwNCj4gPiArICAgICAgICAoaW52X2Rlc2MtPnZhbFsxXSAm
IFZURF9JTlZfREVTQ19QQVNJRENfUlNWRF9WQUwxKSB8fA0KPiA+ICsgICAgICAgIChpbnZfZGVz
Yy0+dmFsWzJdICYgVlREX0lOVl9ERVNDX1BBU0lEQ19SU1ZEX1ZBTDIpIHx8DQo+ID4gKyAgICAg
ICAgKGludl9kZXNjLT52YWxbM10gJiBWVERfSU5WX0RFU0NfUEFTSURDX1JTVkRfVkFMMykpIHsN
Cj4gPiArICAgICAgICBlcnJvcl9yZXBvcnRfb25jZSgibm9uLXplcm8tZmllbGQtaW4tcGNfaW52
X2Rlc2MgaGk6IDB4JSIgUFJJeDY0DQo+ID4gKyAgICAgICAgICAgICAgICAgICIgbG86IDB4JSIg
UFJJeDY0LCBpbnZfZGVzYy0+dmFsWzFdLCBpbnZfZGVzYy0+dmFsWzBdKTsNCj4gPiArICAgICAg
ICByZXR1cm4gZmFsc2U7DQo+ID4gKyAgICB9DQo+ID4gKw0KPiA+ICsgICAgZG9tYWluX2lkID0g
VlREX0lOVl9ERVNDX1BBU0lEQ19ESUQoaW52X2Rlc2MtPnZhbFswXSk7DQo+ID4gKyAgICBwYXNp
ZCA9IFZURF9JTlZfREVTQ19QQVNJRENfUEFTSUQoaW52X2Rlc2MtPnZhbFswXSk7DQo+ID4gKw0K
PiA+ICsgICAgc3dpdGNoIChpbnZfZGVzYy0+dmFsWzBdICYgVlREX0lOVl9ERVNDX1BBU0lEQ19H
KSB7DQo+ID4gKyAgICBjYXNlIFZURF9JTlZfREVTQ19QQVNJRENfRFNJOg0KPiA+ICsgICAgICAg
IHJldCA9IHZ0ZF9wYXNpZF9jYWNoZV9kc2kocywgZG9tYWluX2lkKTsNCj4gPiArICAgICAgICBi
cmVhazsNCj4gPiArDQo+ID4gKyAgICBjYXNlIFZURF9JTlZfREVTQ19QQVNJRENfUEFTSURfU0k6
DQo+ID4gKyAgICAgICAgcmV0ID0gdnRkX3Bhc2lkX2NhY2hlX3BzaShzLCBkb21haW5faWQsIHBh
c2lkKTsNCj4gPiArICAgICAgICBicmVhazsNCj4gPiArDQo+ID4gKyAgICBjYXNlIFZURF9JTlZf
REVTQ19QQVNJRENfR0xPQkFMOg0KPiA+ICsgICAgICAgIHJldCA9IHZ0ZF9wYXNpZF9jYWNoZV9n
c2kocyk7DQo+ID4gKyAgICAgICAgYnJlYWs7DQo+ID4gKw0KPiA+ICsgICAgZGVmYXVsdDoNCj4g
PiArICAgICAgICBlcnJvcl9yZXBvcnRfb25jZSgiaW52YWxpZC1pbnYtZ3JhbnUtaW4tcGNfaW52
X2Rlc2MgaGk6IDB4JSIgUFJJeDY0DQo+ID4gKyAgICAgICAgICAgICAgICAgICIgbG86IDB4JSIg
UFJJeDY0LCBpbnZfZGVzYy0+dmFsWzFdLCBpbnZfZGVzYy0+dmFsWzBdKTsNCj4gPiArICAgICAg
ICByZXR1cm4gZmFsc2U7DQo+ID4gKyAgICB9DQo+ID4gKw0KPiA+ICsgICAgcmV0dXJuIChyZXQg
PT0gMCkgPyB0cnVlIDogZmFsc2U7DQo+ID4gK30NCj4gPiArDQo+ID4gIHN0YXRpYyBib29sIHZ0
ZF9wcm9jZXNzX2ludl9pZWNfZGVzYyhJbnRlbElPTU1VU3RhdGUgKnMsDQo+ID4gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWVERJbnZEZXNjICppbnZfZGVzYykNCj4gPiAg
ew0KPiA+IEBAIC0yNDQxLDEyICsyNDk4LDExIEBAIHN0YXRpYyBib29sIHZ0ZF9wcm9jZXNzX2lu
dl9kZXNjKEludGVsSU9NTVVTdGF0ZQ0KPiAqcykNCj4gPiAgICAgICAgICB9DQo+ID4gICAgICAg
ICAgYnJlYWs7DQo+ID4NCj4gPiAtICAgIC8qDQo+ID4gLSAgICAgKiBUT0RPOiB0aGUgZW50aXR5
IG9mIGJlbG93IHR3byBjYXNlcyB3aWxsIGJlIGltcGxlbWVudGVkIGluIGZ1dHVyZSBzZXJpZXMu
DQo+ID4gLSAgICAgKiBUbyBtYWtlIGd1ZXN0ICh3aGljaCBpbnRlZ3JhdGVzIHNjYWxhYmxlIG1v
ZGUgc3VwcG9ydCBwYXRjaCBzZXQgaW4NCj4gPiAtICAgICAqIGlvbW11IGRyaXZlcikgd29yaywg
anVzdCByZXR1cm4gdHJ1ZSBpcyBlbm91Z2ggc28gZmFyLg0KPiA+IC0gICAgICovDQo+ID4gICAg
ICBjYXNlIFZURF9JTlZfREVTQ19QQzoNCj4gPiArICAgICAgICB0cmFjZV92dGRfaW52X2Rlc2Mo
InBhc2lkLWNhY2hlIiwgaW52X2Rlc2MudmFsWzFdLCBpbnZfZGVzYy52YWxbMF0pOw0KPiANCj4g
Q291bGQgYmUgaGVscGZ1bCBpZiB5b3UgZHVtcCBbMnwzXSB0b2dldGhlciBoZXJlLi4uDQoNCnN1
cmUuIExldCBtZSBhZGQgaXQgaW4gbmV4dCB2ZXJzaW9uLg0KDQo+ID4gKyAgICAgICAgaWYgKCF2
dGRfcHJvY2Vzc19wYXNpZF9kZXNjKHMsICZpbnZfZGVzYykpIHsNCj4gPiArICAgICAgICAgICAg
cmV0dXJuIGZhbHNlOw0KPiA+ICsgICAgICAgIH0NCj4gPiAgICAgICAgICBicmVhazsNCj4gPg0K
PiA+ICAgICAgY2FzZSBWVERfSU5WX0RFU0NfUElPVExCOg0KPiA+IGRpZmYgLS1naXQgYS9ody9p
Mzg2L2ludGVsX2lvbW11X2ludGVybmFsLmggYi9ody9pMzg2L2ludGVsX2lvbW11X2ludGVybmFs
LmgNCj4gPiBpbmRleCA4NjY4NzcxLi5jNmNiMjhiIDEwMDY0NA0KPiA+IC0tLSBhL2h3L2kzODYv
aW50ZWxfaW9tbXVfaW50ZXJuYWwuaA0KPiA+ICsrKyBiL2h3L2kzODYvaW50ZWxfaW9tbXVfaW50
ZXJuYWwuaA0KPiA+IEBAIC00NDUsNiArNDQ1LDE4IEBAIHR5cGVkZWYgdW5pb24gVlRESW52RGVz
YyBWVERJbnZEZXNjOw0KPiA+ICAjZGVmaW5lIFZURF9TUFRFX0xQQUdFX0w0X1JTVkRfTUFTSyhh
dykgXA0KPiA+ICAgICAgICAgICgweDg4MFVMTCB8IH4oVlREX0hBV19NQVNLKGF3KSB8IFZURF9T
TF9JR05fQ09NKSkNCj4gPg0KPiA+ICsjZGVmaW5lIFZURF9JTlZfREVTQ19QQVNJRENfRyAgICAg
ICAgICAoM1VMTCA8PCA0KQ0KPiA+ICsjZGVmaW5lIFZURF9JTlZfREVTQ19QQVNJRENfUEFTSUQo
dmFsKSAoKCh2YWwpID4+IDMyKSAmIDB4ZmZmZmZVTEwpDQo+ID4gKyNkZWZpbmUgVlREX0lOVl9E
RVNDX1BBU0lEQ19ESUQodmFsKSAgICgoKHZhbCkgPj4gMTYpICYNCj4gVlREX0RPTUFJTl9JRF9N
QVNLKQ0KPiA+ICsjZGVmaW5lIFZURF9JTlZfREVTQ19QQVNJRENfUlNWRF9WQUwwICAweGZmZjAw
MDAwMDAwMGZmYzBVTEwNCj4gDQo+IE5pdDogTWluZCB0byBjb21tZW50IGhlcmUgdGhhdCBiaXQg
OS0xMSBpcyBtYXJrZWQgYXMgemVybyByYXRoZXIgdGhhbg0KPiByZXNlcnZlZD8gIFRoaXMgc2Vl
bXMgdG8gd29yayBidXQgaWYgYml0IDktMTEgY2FuIGJlIG5vbi16ZXJvIGluIHNvbWUNCj4gb3Ro
ZXIgZGVzY3JpcHRvcnMgdGhlbiBpdCB3b3VsZCBiZSBjbGVhcmVyIHRvIGRlZmluZSBpdCBhcw0K
PiAweGZmZjAwMDAwMDAwMGYxYzBVTEwgdGhlbiBleHBsaWNpdGx5IGNoZWNrIGJpdHMgOS0xMS4N
Cj4gDQo+IE90aGVyd2lzZSBsb29rcyBnb29kIHRvIG1lLg0KDQpZb3UgYXJlIHJpZ2h0LiBUaGlz
IGlzIG5vdCByZXNlcnZlZC4gSXQncyBwYXJ0cyBvZiB0aGUgZGVzY3JpcHRvciB0eXBlIG5vdy4g
V2lsbA0KZml4IGl0IGluIG5leHQgdmVyc2lvbi4NCg0KUmVnYXJkcywNCllpIExpdQ0K
