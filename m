Return-Path: <kvm+bounces-52956-lists+kvm=lfdr.de@vger.kernel.org>
X-Original-To: lists+kvm@lfdr.de
Delivered-To: lists+kvm@lfdr.de
Received: from am.mirrors.kernel.org (am.mirrors.kernel.org [147.75.80.249])
	by mail.lfdr.de (Postfix) with ESMTPS id 3A481B0BACB
	for <lists+kvm@lfdr.de>; Mon, 21 Jul 2025 04:29:47 +0200 (CEST)
Received: from smtp.subspace.kernel.org (relay.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-ECDSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by am.mirrors.kernel.org (Postfix) with ESMTPS id 57AC1189F09B
	for <lists+kvm@lfdr.de>; Mon, 21 Jul 2025 02:29:08 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 7D4EA2236FC;
	Mon, 21 Jul 2025 02:27:47 +0000 (UTC)
X-Original-To: kvm@vger.kernel.org
Received: from baidu.com (mx22.baidu.com [220.181.50.185])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 11A8F1F4289;
	Mon, 21 Jul 2025 02:27:43 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=220.181.50.185
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1753064867; cv=none; b=LgSQjazyPnlnNB8qzsfe1VCx7e+fDKR5RbMHK6Zmv3+TpoxadFniAv36yTWfP6shUkULpZyghz+7ZeUW6o9fcTVM/TiViqIP9wC7PkwF8EpdNfjRNOOiDTF3cRsf7hIdmfCEqPUCRwAjJ5A+c8IkqOkzMYN83fEN/irLGjlB8og=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1753064867; c=relaxed/simple;
	bh=x+zj8fFpS5eWHmQYb3/NsvA8xbXRIWkSvclvHT/Xf3g=;
	h=From:To:CC:Subject:Date:Message-ID:References:In-Reply-To:
	 Content-Type:MIME-Version; b=rFZNTJvHWI8oXt/daeBjS/2/OBZ7vow4/585JFwn2Auqy5EQTl/Uu6c77qNxvNiPUsfT5LWgBGyFe/a/cIy+3uSuPaDj9IlUNmkWsmkaEUat3H/Qn1izuEFU3JHQkhv5WT73eTiwDrnA6hMLnP1EaTuolL6DwNgFKDl4gMK1HC0=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dmarc=pass (p=quarantine dis=none) header.from=baidu.com; spf=pass smtp.mailfrom=baidu.com; arc=none smtp.client-ip=220.181.50.185
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=quarantine dis=none) header.from=baidu.com
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=baidu.com
From: "Li,Rongqing" <lirongqing@baidu.com>
To: Sean Christopherson <seanjc@google.com>
CC: "pbonzini@redhat.com" <pbonzini@redhat.com>, "vkuznets@redhat.com"
	<vkuznets@redhat.com>, "tglx@linutronix.de" <tglx@linutronix.de>,
	"mingo@redhat.com" <mingo@redhat.com>, "bp@alien8.de" <bp@alien8.de>,
	"dave.hansen@linux.intel.com" <dave.hansen@linux.intel.com>, "x86@kernel.org"
	<x86@kernel.org>, "hpa@zytor.com" <hpa@zytor.com>, "kvm@vger.kernel.org"
	<kvm@vger.kernel.org>, "linux-kernel@vger.kernel.org"
	<linux-kernel@vger.kernel.org>
Subject: =?gb2312?B?tPC4tDogWz8/Pz9dIFJlOiBbUEFUQ0hdIHg4Ni9rdm06IFJlb3JkZXIgUFYg?=
 =?gb2312?Q?spinlock_checks_for_dedicated_CPU_case?=
Thread-Topic: [????] Re: [PATCH] x86/kvm: Reorder PV spinlock checks for
 dedicated CPU case
Thread-Index: AQHb+ebbkcsK2yip8kqdhSixfTeD3A==
Date: Mon, 21 Jul 2025 02:26:25 +0000
Message-ID: <c985fbdb96aa44cdb9788d92046b958e@baidu.com>
References: <20250718094936.5283-1-lirongqing@baidu.com>
 <aHpWW0ZPuI5thDqZ@google.com>
In-Reply-To: <aHpWW0ZPuI5thDqZ@google.com>
Accept-Language: zh-CN, en-US
Content-Language: zh-CN
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
Content-Type: text/plain; charset="gb2312"
Content-Transfer-Encoding: base64
Precedence: bulk
X-Mailing-List: kvm@vger.kernel.org
List-Id: <kvm.vger.kernel.org>
List-Subscribe: <mailto:kvm+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:kvm+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
X-FEAS-Client-IP: 172.31.50.46
X-FE-Policy-ID: 52:10:53:SYSTEM

DQo+IA0KPiBPbiBGcmksIEp1bCAxOCwgMjAyNSwgbGlyb25ncWluZyB3cm90ZToNCj4gPiBGcm9t
OiBMaSBSb25nUWluZyA8bGlyb25ncWluZ0BiYWlkdS5jb20+DQo+ID4NCj4gPiBXaGVuIGEgdkNQ
VSBoYXMgYSBkZWRpY2F0ZWQgcGh5c2ljYWwgQ1BVLCB0eXBpY2FsbHksIHRoZSBoeXBlcnZpc29y
DQo+ID4gZGlzYWJsZXMgdGhlIEhMVCBleGl0IHRvbywNCj4gDQo+IEJ1dCBjZXJ0YWlubHkgbm90
IGFsd2F5cy4gIEUuZy4gdGhlIGh5cGVydmlzb3IgbWF5IGRpc2FibGUgTVdBSVQgZXhpdGluZyBi
dXQNCj4gbm90IEhMVCBleGl0aW5nLCBzbyB0aGF0IHRoZSBoeXBlcnZpc29yIGNhbiB0YWtlIGFj
dGlvbiBpZiBhIGd1ZXN0IGtlcm5lbCByZWZ1c2VzDQo+IHRvIHVzZSBNV0FJVCBmb3Igd2hhdGV2
ZXIgcmVhc29uLg0KPiANCj4gSSBhc3N1bWUgbmF0aXZlIHFzcGlubG9ja3Mgb3V0cGVyZm9ybSB2
aXJ0X3NwaW5fbG9jaygpIGlycmVzcGVjdGl2ZSBvZiBITFQNCj4gZXhpdGluZyB3aGVuIHRoZSB2
Q1BVIGhhcyBhIGRlZGljYXRlZCBwQ1BVPyANCg0KIkkgdGhpbmsgdGhpcyBpcyB0cnVlLiBBcyB0
aGUgY29tbWVudCAoS1ZNOiBYODY6IENob29zZSBxc3BpbmxvY2sgd2hlbiBkZWRpY2F0ZWQgcGh5
c2ljYWwgQ1BVcyBhcmUgYXZhaWxhYmxlKSBzYXlzOg0KJ1BWX0RFRElDQVRFRCA9IDEsIFBWX1VO
SEFMVCA9IGFueXRoaW5nOiBkZWZhdWx0IGlzIHFzcGlubG9jaycuIA0KSG93ZXZlciwgdGhlIGN1
cnJlbnQgY29kZSBkb2Vzbid0IHJlZmxlY3QgdGhpcy4gV2hlbiBQVl9VTkhBTFQ9MCwgaXQgc3Rp
bGwgdXNlcyB2aXJ0X3NwaW5fbG9jaygpLiBNeSBwYXRjaCBpcyBmaXhpbmcgdGhpcyBpbmNvbnNp
c3RlbmN5Lg0KDQpjb21taXQgYjI3OThiYTBiODc2OWI0MmYwMDg5OWI0NGE1MzhiNWZjZWNiNDgw
ZA0KQXV0aG9yOiBXYW5wZW5nIExpIDx3YW5wZW5nbGlAdGVuY2VudC5jb20+DQpEYXRlOiAgIFR1
ZSBGZWIgMTMgMDk6MDU6NDEgMjAxOCArMDgwMA0KDQogICAgS1ZNOiBYODY6IENob29zZSBxc3Bp
bmxvY2sgd2hlbiBkZWRpY2F0ZWQgcGh5c2ljYWwgQ1BVcyBhcmUgYXZhaWxhYmxlDQoNCiAgICBX
YWltYW4gTG9uZyBtZW50aW9uZWQgdGhhdDoNCiAgICA+IEdlbmVyYWxseSBzcGVha2luZywgdW5m
YWlyIGxvY2sgcGVyZm9ybXMgd2VsbCBmb3IgVk1zIHdpdGggYSBzbWFsbA0KICAgID4gbnVtYmVy
IG9mIHZDUFVzLiBOYXRpdmUgcXNwaW5sb2NrIG1heSBwZXJmb3JtIGJldHRlciB0aGFuIHB2cXNw
aW5sb2NrDQogICAgPiBpZiB0aGVyZSBpcyB2Q1BVIHBpbm5pbmcgYW5kIHRoZXJlIGlzIG5vIHZD
UFUgb3Zlci1jb21taXRtZW50Lg0KDQogICAgVGhpcyBwYXRjaCB1c2VzIHRoZSBLVk1fSElOVFNf
REVESUNBVEVEIHBlcmZvcm1hbmNlIGhpbnQsIHdoaWNoIGlzDQogICAgcHJvdmlkZWQgYnkgdGhl
IGh5cGVydmlzb3IgYWRtaW4sIHRvIGNob29zZSB0aGUgcXNwaW5sb2NrIGFsZ29yaXRobQ0KICAg
IHdoZW4gYSBkZWRpY2F0ZWQgcGh5c2ljYWwgQ1BVIGlzIGF2YWlsYWJsZS4NCg0KICAgIFBWX0RF
RElDQVRFRCA9IDEsIFBWX1VOSEFMVCA9IGFueXRoaW5nOiBkZWZhdWx0IGlzIHFzcGlubG9jaw0K
ICAgIFBWX0RFRElDQVRFRCA9IDAsIFBWX1VOSEFMVCA9IDE6IGRlZmF1bHQgaXMgSHlicmlkIFBW
IHF1ZXVlZC91bmZhaXIgbG9jaw0KICAgIFBWX0RFRElDQVRFRCA9IDAsIFBWX1VOSEFMVCA9IDA6
IGRlZmF1bHQgaXMgdGFzDQoNCg0KDQo+IElmIHNvLCBpdCdzIHByb2JhYmx5IHdvcnRoIGNhbGxp
bmcNCj4gdGhhdCBvdXQgaW4gdGhlIGNoYW5nZWxvZywgZS5nLiB0byBhc3N1YWdlIGFueSBmZWFy
cy9jb25jZXJucyBhYm91dCB0aGlzIGJlaW5nDQo+IHVuZGVzaXJhYmxlIGZvciBzZXR1cHMgd2l0
aCBLVk1fSElOVFNfUkVBTFRJTUUgKmFuZCoNCj4gS1ZNX0ZFQVRVUkVfUFZfVU5IQUxULg0KPiAN
Ck9rLCBJIHdpbGwgcmV3cml0ZSB0aGUgY2hhbmdlbG9nDQoNCklmIHlvdSBzdGlsbCBoYXZlIGNv
bmNlcm5zLCBJIHRoaW5rIHdlIGNhbiBjaGFuZ2UgdGhlIGNvZGUgYXMgYmVsb3cNCg0KZGlmZiAt
LWdpdCBhL2FyY2gveDg2L2tlcm5lbC9rdm0uYyBiL2FyY2gveDg2L2tlcm5lbC9rdm0uYw0KaW5k
ZXggOTIxYzFjNy4uNjI3NWQ3OCAxMDA2NDQNCi0tLSBhL2FyY2gveDg2L2tlcm5lbC9rdm0uYw0K
KysrIGIvYXJjaC94ODYva2VybmVsL2t2bS5jDQpAQCAtMTA3OCw4ICsxMDc4LDE0IEBAIHZvaWQg
X19pbml0IGt2bV9zcGlubG9ja19pbml0KHZvaWQpDQogICAgICAgICAqIHByZWZlcnJlZCBvdmVy
IG5hdGl2ZSBxc3BpbmxvY2sgd2hlbiB2Q1BVIGlzIHByZWVtcHRlZC4NCiAgICAgICAgICovDQog
ICAgICAgIGlmICgha3ZtX3BhcmFfaGFzX2ZlYXR1cmUoS1ZNX0ZFQVRVUkVfUFZfVU5IQUxUKSkg
ew0KLSAgICAgICAgICAgICAgIHByX2luZm8oIlBWIHNwaW5sb2NrcyBkaXNhYmxlZCwgbm8gaG9z
dCBzdXBwb3J0XG4iKTsNCi0gICAgICAgICAgICAgICByZXR1cm47DQorICAgICAgICAgICAgICAg
aWYgKGt2bV9wYXJhX2hhc19oaW50KEtWTV9ISU5UU19SRUFMVElNRSkpIHsNCisgICAgICAgICAg
ICAgICAgICAgICAgIHByX2luZm8oIlBWIHNwaW5sb2NrcyBkaXNhYmxlZCB3aXRoIEtWTV9ISU5U
U19SRUFMVElNRSBoaW50c1xuIik7DQorICAgICAgICAgICAgICAgICAgICAgICBnb3RvIG91dDsN
CisgICAgICAgICAgICAgICB9DQorICAgICAgICAgICAgICAgZWxzZSB7DQorICAgICAgICAgICAg
ICAgICAgICAgICBwcl9pbmZvKCJQViBzcGlubG9ja3MgZGlzYWJsZWQsIG5vIGhvc3Qgc3VwcG9y
dFxuIik7DQorICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQorICAgICAgICAgICAgICAg
fQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoNCg0KVGhhbmtzDQoNCi1MaQ0KDQoNCj4gPiByZW5k
ZXJpbmcgdGhlIEtWTV9GRUFUVVJFX1BWX1VOSEFMVCBmZWF0dXJlIHVuYXZhaWxhYmxlLCBhbmQN
Cj4gPiB2aXJ0X3NwaW5fbG9ja19rZXkgaXMgZXhwZWN0ZWQgdG8gYmUgZGlzYWJsZWQgaW4gdGhp
cyBjb25maWd1cmF0aW9uLCBidXQ6DQo+ID4NCj4gPiBUaGUgcHJvYmxlbWF0aWMgZXhlY3V0aW9u
IGZsb3cgY2F1c2VkIHRoZSBlbmFibGVkIHZpcnRfc3Bpbl9sb2NrX2tleToNCj4gPiAtIEZpcnN0
IGNoZWNrIFBWX1VOSEFMVA0KPiA+IC0gVGhlbiBjaGVjayBkZWRpY2F0ZWQgQ1BVcw0KPiA+DQo+
ID4gU28gY2hhbmdlIHRoZSBvcmRlcjoNCj4gPiAtIEZpcnN0IGNoZWNrIGRlZGljYXRlZCBDUFVz
DQo+ID4gLSBUaGVuIGNoZWNrIFBWX1VOSEFMVA0KPiA+DQo+ID4gVGhpcyBlbnN1cmVzIHZpcnRf
c3Bpbl9sb2NrX2tleSBpcyBkaXNhYmxlIHdoZW4gZGVkaWNhdGVkIHBoeXNpY2FsDQo+ID4gQ1BV
cyBhcmUgYXZhaWxhYmxlIGFuZCBITFQgZXhpdCBpcyBkaXNhYmxlZCwgYW5kIHRoaXMgd2lsbCBn
aXZlcyBhDQo+ID4gcHJldHR5IHBlcmZvcm1hbmNlIGJvb3N0IGF0IGhpZ2ggY29udGVudGlvbiBs
ZXZlbA0KPiA+DQo+ID4gU2lnbmVkLW9mZi1ieTogTGkgUm9uZ1FpbmcgPGxpcm9uZ3FpbmdAYmFp
ZHUuY29tPg0KPiA+IC0tLQ0KPiA+ICBhcmNoL3g4Ni9rZXJuZWwva3ZtLmMgfCAyMCArKysrKysr
KysrLS0tLS0tLS0tLQ0KPiA+ICAxIGZpbGUgY2hhbmdlZCwgMTAgaW5zZXJ0aW9ucygrKSwgMTAg
ZGVsZXRpb25zKC0pDQo+ID4NCj4gPiBkaWZmIC0tZ2l0IGEvYXJjaC94ODYva2VybmVsL2t2bS5j
IGIvYXJjaC94ODYva2VybmVsL2t2bS5jIGluZGV4DQo+ID4gOTIxYzFjNy4uOWNkYTc5ZiAxMDA2
NDQNCj4gPiAtLS0gYS9hcmNoL3g4Ni9rZXJuZWwva3ZtLmMNCj4gPiArKysgYi9hcmNoL3g4Ni9r
ZXJuZWwva3ZtLmMNCj4gPiBAQCAtMTA3MywxNiArMTA3Myw2IEBAIHN0YXRpYyB2b2lkIGt2bV93
YWl0KHU4ICpwdHIsIHU4IHZhbCkgIHZvaWQNCj4gPiBfX2luaXQga3ZtX3NwaW5sb2NrX2luaXQo
dm9pZCkgIHsNCj4gPiAgCS8qDQo+ID4gLQkgKiBJbiBjYXNlIGhvc3QgZG9lc24ndCBzdXBwb3J0
IEtWTV9GRUFUVVJFX1BWX1VOSEFMVCB0aGVyZSBpcyBzdGlsbCBhbg0KPiA+IC0JICogYWR2YW50
YWdlIG9mIGtlZXBpbmcgdmlydF9zcGluX2xvY2tfa2V5IGVuYWJsZWQ6IHZpcnRfc3Bpbl9sb2Nr
KCkgaXMNCj4gPiAtCSAqIHByZWZlcnJlZCBvdmVyIG5hdGl2ZSBxc3BpbmxvY2sgd2hlbiB2Q1BV
IGlzIHByZWVtcHRlZC4NCj4gPiAtCSAqLw0KPiA+IC0JaWYgKCFrdm1fcGFyYV9oYXNfZmVhdHVy
ZShLVk1fRkVBVFVSRV9QVl9VTkhBTFQpKSB7DQo+ID4gLQkJcHJfaW5mbygiUFYgc3BpbmxvY2tz
IGRpc2FibGVkLCBubyBob3N0IHN1cHBvcnRcbiIpOw0KPiA+IC0JCXJldHVybjsNCj4gPiAtCX0N
Cj4gPiAtDQo+ID4gLQkvKg0KPiA+ICAJICogRGlzYWJsZSBQViBzcGlubG9ja3MgYW5kIHVzZSBu
YXRpdmUgcXNwaW5sb2NrIHdoZW4gZGVkaWNhdGVkIHBDUFVzDQo+ID4gIAkgKiBhcmUgYXZhaWxh
YmxlLg0KPiA+ICAJICovDQo+ID4gQEAgLTExMDEsNiArMTA5MSwxNiBAQCB2b2lkIF9faW5pdCBr
dm1fc3BpbmxvY2tfaW5pdCh2b2lkKQ0KPiA+ICAJCWdvdG8gb3V0Ow0KPiA+ICAJfQ0KPiA+DQo+
ID4gKwkvKg0KPiA+ICsJICogSW4gY2FzZSBob3N0IGRvZXNuJ3Qgc3VwcG9ydCBLVk1fRkVBVFVS
RV9QVl9VTkhBTFQgdGhlcmUgaXMgc3RpbGwgYW4NCj4gPiArCSAqIGFkdmFudGFnZSBvZiBrZWVw
aW5nIHZpcnRfc3Bpbl9sb2NrX2tleSBlbmFibGVkOiB2aXJ0X3NwaW5fbG9jaygpIGlzDQo+ID4g
KwkgKiBwcmVmZXJyZWQgb3ZlciBuYXRpdmUgcXNwaW5sb2NrIHdoZW4gdkNQVSBpcyBwcmVlbXB0
ZWQuDQo+ID4gKwkgKi8NCj4gPiArCWlmICgha3ZtX3BhcmFfaGFzX2ZlYXR1cmUoS1ZNX0ZFQVRV
UkVfUFZfVU5IQUxUKSkgew0KPiA+ICsJCXByX2luZm8oIlBWIHNwaW5sb2NrcyBkaXNhYmxlZCwg
bm8gaG9zdCBzdXBwb3J0XG4iKTsNCj4gPiArCQlyZXR1cm47DQo+ID4gKwl9DQo+ID4gKw0KPiA+
ICAJcHJfaW5mbygiUFYgc3BpbmxvY2tzIGVuYWJsZWRcbiIpOw0KPiA+DQo+ID4gIAlfX3B2X2lu
aXRfbG9ja19oYXNoKCk7DQo+ID4gLS0NCj4gPiAyLjkuNA0KPiA+DQo=

