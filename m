Return-Path: <kvm-owner@vger.kernel.org>
X-Original-To: lists+kvm@lfdr.de
Delivered-To: lists+kvm@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 3613B25577B
	for <lists+kvm@lfdr.de>; Fri, 28 Aug 2020 11:23:31 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1728897AbgH1JXV (ORCPT <rfc822;lists+kvm@lfdr.de>);
        Fri, 28 Aug 2020 05:23:21 -0400
Received: from szxga08-in.huawei.com ([45.249.212.255]:42210 "EHLO huawei.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1728016AbgH1JXU (ORCPT <rfc822;kvm@vger.kernel.org>);
        Fri, 28 Aug 2020 05:23:20 -0400
Received: from DGGEML403-HUB.china.huawei.com (unknown [172.30.72.56])
        by Forcepoint Email with ESMTP id 09FA52622758182B89DD;
        Fri, 28 Aug 2020 17:23:17 +0800 (CST)
Received: from DGGEML524-MBX.china.huawei.com ([169.254.1.71]) by
 DGGEML403-HUB.china.huawei.com ([fe80::74d9:c659:fbec:21fa%31]) with mapi id
 14.03.0487.000; Fri, 28 Aug 2020 17:23:09 +0800
From:   "Maoming (maoming, Cloud Infrastructure Service Product Dept.)" 
        <maoming.maoming@huawei.com>
To:     Peter Xu <peterx@redhat.com>
CC:     "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
        "kvm@vger.kernel.org" <kvm@vger.kernel.org>,
        "alex.williamson@redhat.com" <alex.williamson@redhat.com>,
        "cohuck@redhat.com" <cohuck@redhat.com>,
        "Zhoujian (jay)" <jianjay.zhou@huawei.com>,
        "Huangweidong (C)" <weidong.huang@huawei.com>,
        "aarcange@redhat.com" <aarcange@redhat.com>,
        wangyunjian <wangyunjian@huawei.com>
Subject: =?utf-8?B?562U5aSNOiDnrZTlpI06IFtQQVRDSCBWMl0gdmZpbyBkbWFfbWFwL3VubWFw?=
 =?utf-8?Q?:_optimized_for_hugetlbfs_pages?=
Thread-Topic: =?utf-8?B?562U5aSNOiBbUEFUQ0ggVjJdIHZmaW8gZG1hX21hcC91bm1hcDogb3B0aW1p?=
 =?utf-8?Q?zed_for_hugetlbfs_pages?=
Thread-Index: AQHWcePn246e6Z2xQkKwoyKqsTP1MqlI20CAgAGejeD//5OugIADObaQ
Date:   Fri, 28 Aug 2020 09:23:08 +0000
Message-ID: <8B561EC9A4D13649A62CF60D3A8E8CB28C2DBE7A@dggeml524-mbx.china.huawei.com>
References: <20200814023729.2270-1-maoming.maoming@huawei.com>
 <20200825205907.GB8235@xz-x1>
 <8B561EC9A4D13649A62CF60D3A8E8CB28C2D9ABB@dggeml524-mbx.china.huawei.com>
 <20200826151509.GD8235@xz-x1>
In-Reply-To: <20200826151509.GD8235@xz-x1>
Accept-Language: en-US
Content-Language: zh-CN
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [10.174.151.129]
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-CFilter-Loop: Reflected
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org

DQpPbiBXZWQsIEF1ZyAyNiwgMjAyMCBhdCAwMTo1Njo0M1BNICswMDAwLCBNYW9taW5nIChtYW9t
aW5nLCBDbG91ZCBJbmZyYXN0cnVjdHVyZSBTZXJ2aWNlIFByb2R1Y3QgRGVwdC4pIHdyb3RlOg0K
PiA+ICsJLyoNCj4gPiArCSAqIFVubGlrZSBUSFAsIHRoZSBzcGxpdHRpbmcgc2hvdWxkIG5vdCBo
YXBwZW4gZm9yIGh1Z2V0bGIgcGFnZXMuDQo+ID4gKwkgKiBTaW5jZSBQR19yZXNlcnZlZCBpcyBu
b3QgcmVsZXZhbnQgZm9yIGNvbXBvdW5kIHBhZ2VzLCBhbmQgdGhlIHBmbiBvZg0KPiA+ICsJICog
UEFHRV9TSVpFIHBhZ2Ugd2hpY2ggaW4gaHVnZXRsYiBwYWdlcyBpcyB2YWxpZCwNCj4gPiArCSAq
IGl0IGlzIG5vdCBuZWNlc3NhcnkgdG8gY2hlY2sgcnN2ZCBmb3IgaHVnZXRsYiBwYWdlcy4NCj4g
PiArCSAqIFdlIGRvIG5vdCBuZWVkIHRvIGFsbG9jIHBhZ2VzIGJlY2F1c2Ugb2YgdmFkZHIgYW5k
IHdlIGNhbiBmaW5pc2ggYWxsDQo+ID4gKwkgKiB3b3JrIGJ5IGEgc2luZ2xlIG9wZXJhdGlvbiB0
byB0aGUgaGVhZCBwYWdlLg0KPiA+ICsJICovDQo+ID4gKwlhdG9taWNfYWRkKGNvbnRpZ3VvdXNf
bnBhZ2UsIGNvbXBvdW5kX3BpbmNvdW50X3B0cihoZWFkKSk7DQo+ID4gKwlwYWdlX3JlZl9hZGQo
aGVhZCwgY29udGlndW91c19ucGFnZSk7DQo+ID4gKwltb2Rfbm9kZV9wYWdlX3N0YXRlKHBhZ2Vf
cGdkYXQoaGVhZCksIE5SX0ZPTExfUElOX0FDUVVJUkVELCANCj4gPiArY29udGlndW91c19ucGFn
ZSk7DQo+IA0KPiBJIHRoaW5rIEkgYXNrZWQgdGhpcyBxdWVzdGlvbiBpbiB2MSwgYnV0IEkgZGlk
bid0IGdldCBhbnkgYW5zd2VyLi4uIFNvIEknbSB0cnlpbmcgYWdhaW4uLi4NCj4gDQo+IENvdWxk
IEkgYXNrIHdoeSBtYW51YWwgcmVmZXJlbmNpbmcgb2YgcGFnZXMgaXMgZG9uZSBoZXJlIHJhdGhl
ciB0aGFuIA0KPiB1c2luZw0KPiBwaW5fdXNlcl9wYWdlc19yZW1vdGUoKSBqdXN0IGxpa2Ugd2hh
dCB3ZSd2ZSBkb25lIHdpdGggDQo+IHZhZGRyX2dldF9wZm4oKSwgYW5kIGxldA0KPiB0cnlfZ3Jh
Yl9wYWdlKCkgdG8gZG8gdGhlIHBhZ2UgcmVmZXJlbmNlIGFuZCBhY2NvdW50aW5ncz8NCj4gDQo+
IEkgZmVlbCBsaWtlIHRoaXMgYXQgbGVhc3QgaXMgYWdhaW5zdCB0aGUgRk9MTF9QSU4gd29ya2Zs
b3cgb2YgZ3VwLCBiZWNhdXNlIHRob3NlIEZPTExfUElOIHBhdGhzIHdlcmUgYnlwYXNzZWQsIGFm
YWljdC4NCj4gDQo+IA0KPiBIaSwNCj4gTXkgYXBvbG9naWVzIGZvciBub3QgYW5zd2VyaW5nIHlv
dXIgcXVlc3Rpb24uDQo+IEFzIEkgdW5kZXJzdGFuZCwgcGluX3VzZXJfcGFnZXNfcmVtb3RlKCkg
bWlnaHQgc3BlbmQgbXVjaCB0aW1lLg0KPiBCZWNhdXNlIGFsbCBQQUdFX1NJWkUtcGFnZXMgaW4g
YSBodWdldGxiIHBhZ2UgYXJlIHBpbm5lZCBvbmUgYnkgb25lIGluIHBpbl91c2VyX3BhZ2VzX3Jl
bW90ZSgpIGFuZCB0cnlfZ3JhYl9wYWdlKCkuDQo+IFNvIEkgdGhpbmsgbWF5YmUgd2UgY2FuIHVz
ZSB0aGVzZSBzaW1wbGUgY29kZSB0byBkbyBhbGwgd29yay4NCj4gQW0gSSB3cm9uZz8gQW5kIGlz
IHRoZXJlIHNvbWV0aGluZyBlbHNlIHdlIGNhbiB1c2U/IEZvciBleGFtcGxlIA0KPiA6cGluX3Vz
ZXJfcGFnZXNfZmFzdCgpDQoNClllYWggSSBjYW4gdW5kZXJzdGFuZCB5b3VyIGNvbmNlcm4sIGhv
d2V2ZXIgc28gZmFyIGl0J3Mgbm90IGFib3V0IHRoZSBwZXJmIGJ1dCBjb3JyZWN0bmVzcy4gIERv
Y3VtZW50YXRpb24vY29yZS1hcGkvcGluX3VzZXJfcGFnZXMucnN0IHRlbGxzIHVzIHRoYXQgd2Ug
c2hvdWxkIGFsd2F5cyB1c2UgcGluX3VzZXJfcGFnZSooKSBBUElzIHRvIHBpbiBETUEgcGFnZXMg
KHdpdGggRk9MTF9MT05HVEVSTSkuICBUaGF0J3Mgc29tZXRoaW5nIHdlIHNob3VsZCBmb2xsb3cg
Zm9yIG5vdywgb3RoZXJ3aXNlIHRoZSBtYWpvciBsb2dpYyBvZiBlaXRoZXIgRk9MTF9QSU4gb3Ig
RlVMTF9MT05HVEVSTSBjb3VsZCBiZSBieXBhc3NlZCB3aXRob3V0IGJlaW5nIG5vdGljZWQuDQoN
CkknbSBub3Qgc3VyZSB3aGV0aGVyIHRoZSBwZXJmIGlzc3VlIGlzIGEgYmlnIG9uZS4gIFNvIGhh
dmUgeW91IHRyaWVkIHRoZSBwaW4gcGFnZSBBUElzIGZpcnN0IGFuZCBkaWQgc29tZSBtZWFzdXJl
bWVudD8gIFRoZXJlIGlzIGluZGVlZCBhIHRpZ2h0IGxvb3AgaW4NCmZvbGxvd19odWdldGxiX3Bh
Z2UoKSBob3dldmVyIG5vdCBzdXJlIGhvdyBtdWNoIGl0J2xsIGFmZmVjdCBWRklPX0lPTU1VX01B
UF9ETUEgaW4gZ2VuZXJhbC4gIEV2ZW4gaWYgd2Ugd2FudCB0byBkbyBzb21ldGhpbmcsIGl0IHNl
ZW1zIHRvIGJlIG1vcmUgc3VpdGFibGUgdG8gYmUgZG9uZSBpbnNpZGUgZm9sbG93X2h1Z2V0bGJf
cGFnZSgpIHJhdGhlciB0aGFuIGluIHZmaW8sIGltaG8uDQoNCkFub3RoZXIgY29tbWVudCBpcyBh
Ym91dCB0aGUgZGVzaWduIG9mIHRoZSB3aG9sZSBwYXRjaCAtIEkgdGhpbmsgQWxleCBjb21tZW50
ZWQgb24gdGhhdCB0b28gb24gdGhlIGF3a3dhcmRuZXNzIG9uIGFwcGVuZGluZyB0aGUgaHVnZXRs
YmZzIGxvZ2ljIHRvIHRoZSBlbmQgb2YgdGhlIGV4aXN0aW5nIGxvZ2ljLiAgQ29uc2lkZXJpbmcg
dGhhdCBjdXJyZW50IGxvZ2ljIG9mIHZmaW9fcGluX3BhZ2VzX3JlbW90ZSgpIGlzICJsZXQncyBw
aW4gc29tZSBwYWdlcyBhcyBsb25nIGFzIGNvbnRpbnVvdXMiLCBub3Qgc3VyZSB3aGV0aGVyIHdl
IGNhbiBtYWtlIGl0IGludG86DQoNCnZmaW9fcGluX3BhZ2VzX3JlbW90ZSgpDQp7DQogIGlmIChQ
YWdlSHVnZShmaXJzdF9wYWdlKSkNCiAgICB2ZmlvX3Bpbl9wYWdlc19odWdldGxiZnMoKTsNCiAg
ZWxzZQ0KICAgIHZmaW9fcGluX3BhZ2VzX25vcm1hbCgpOw0KfQ0KDQpUaGUgdGhpbmcgaXMsIGlm
IHRoZSAxc3QgcGFnZSBpcyBub3JtYWwgcGFnZSwgdGhlbiB0aGUgZm9sbG93LXVwIHBhZ2VzIHNo
b3VsZG4ndCBub3JtYWxseSBiZSBodWdldGxiZnMgcGFnZXMgc28gdGhleSB3b24ndCBiZSBwaHlz
aWNhbGx5IGNvbnRpbnVvdXMuDQpWaWNlIHZlcnNhLiAgSW4gb3RoZXIgd29yZHMsIGVhY2ggY2Fs
bCB0byB2ZmlvX3Bpbl9wYWdlc19yZW1vdGUoKSBzaG91bGQgb25seSBoYW5kbGUgb25seSBvbmUg
dHlwZSBvZiBwYWdlIGFmdGVyIGFsbC4gIFNvIG1heWJlIHdlIGNhbiBkaXZlcmdlIHRoZW0gYXQg
dGhlIGJlZ2lubmluZyBvZiB0aGUgY2FsbCBkaXJlY3RseS4NCg0KLS0NClBldGVyIFh1DQoNCg0K
DQoNCg0KVGhhbmtzIGZvciB5b3VyIHN1Z2dlc3Rpb25zLiBJIHdpbGwgZml4IGl0Lg0KQW5kIEkg
aGF2ZSBhbm90aGVyIHF1ZXN0aW9uLg0KSW4gaHVnZXRsYl9wdXRfcGZuKCksIEkgZGVsZXRlIHVu
cGluX3VzZXJfcGFnZXNfZGlydHlfbG9jaygpIGFuZCB1c2Ugc29tZSBzaW1wbGUgY29kZSB0byBw
dXQgaHVnZXRsYiBwYWdlcy4NCklzIHRoaXMgcmlnaHQ/DQoNCg0KLyoNCiAqIHB1dCBwZm5zIGZv
ciBhIGh1Z2V0bGIgcGFnZQ0KICogQHN0YXJ0OnRoZSBQQUdFX1NJWkUtcGFnZSB3ZSBzdGFydCB0
byBwdXQsY2FuIGJlIGFueSBwYWdlIGluIHRoaXMgaHVnZXRsYiBwYWdlDQogKiBAbnBhZ2U6dGhl
IG51bWJlciBvZiBQQUdFX1NJWkUtcGFnZXMgbmVlZCB0byBwdXQNCiAqIEBwcm90OklPTU1VX1JF
QUQvV1JJVEUNCiAqLw0Kc3RhdGljIGludCBodWdldGxiX3B1dF9wZm4odW5zaWduZWQgbG9uZyBz
dGFydCwgdW5zaWduZWQgaW50IG5wYWdlLCBpbnQgcHJvdCkNCnsNCiAgICAgICAgc3RydWN0IHBh
Z2UgKnBhZ2U7DQogICAgICAgIHN0cnVjdCBwYWdlICpoZWFkOw0KDQogICAgICAgIGlmICghbnBh
Z2UgfHwgIXBmbl92YWxpZChzdGFydCkpDQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQoNCiAg
ICAgICAgcGFnZSA9IHBmbl90b19wYWdlKHN0YXJ0KTsNCiAgICAgICAgaWYgKCFwYWdlIHx8ICFQ
YWdlSHVnZShwYWdlKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgaGVhZCA9
IGNvbXBvdW5kX2hlYWQocGFnZSk7DQogICAgICAgIC8qDQogICAgICAgICAqIFRoZSBsYXN0IHBh
Z2Ugc2hvdWxkIGJlIGluIHRoaXMgaHVnZXRsYiBwYWdlLg0KICAgICAgICAgKiBUaGUgbnVtYmVy
IG9mIHB1dHRpbmcgcGFnZXMgc2hvdWxkIGJlIGVxdWFsIHRvIHRoZSBudW1iZXINCiAgICAgICAg
ICogb2YgZ2V0dGluZyBwYWdlcy5TbyB0aGUgaHVnZXBhZ2UgcGlubmVkIHJlZmNvdW50IGFuZCB0
aGUgbm9ybWFsDQogICAgICAgICAqIHBhZ2UgcmVmY291bnQgY2FuIG5vdCBiZSBzbWFsbGVyIHRo
YW4gbnBhZ2UuDQogICAgICAgICAqLw0KICAgICAgICBpZiAoKGhlYWQgIT0gY29tcG91bmRfaGVh
ZChwZm5fdG9fcGFnZShzdGFydCArIG5wYWdlIC0gMSkpKQ0KICAgICAgICAgICAgICAgIHx8IChw
YWdlX3JlZl9jb3VudChoZWFkKSA8IG5wYWdlKQ0KICAgICAgICAgICAgICAgIHx8IChjb21wb3Vu
ZF9waW5jb3VudChwYWdlKSA8IG5wYWdlKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCg0K
ICAgICAgICBpZiAoKHByb3QgJiBJT01NVV9XUklURSkgJiYgIVBhZ2VEaXJ0eShwYWdlKSkNCiAg
ICAgICAgICAgICAgICBzZXRfcGFnZV9kaXJ0eV9sb2NrKHBhZ2UpOw0KDQogICAgICAgIGF0b21p
Y19zdWIobnBhZ2UsIGNvbXBvdW5kX3BpbmNvdW50X3B0cihoZWFkKSk7DQogICAgICAgIGlmIChw
YWdlX3JlZl9zdWJfYW5kX3Rlc3QoaGVhZCwgbnBhZ2UpKQ0KICAgICAgICAgICAgICAgIF9fcHV0
X3BhZ2UoaGVhZCk7DQoNCiAgICAgICAgbW9kX25vZGVfcGFnZV9zdGF0ZShwYWdlX3BnZGF0KGhl
YWQpLCBOUl9GT0xMX1BJTl9SRUxFQVNFRCwgbnBhZ2UpOw0KICAgICAgICByZXR1cm4gMTsNCn0N
Cg==
