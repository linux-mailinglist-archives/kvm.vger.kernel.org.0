Return-Path: <kvm-owner@vger.kernel.org>
X-Original-To: lists+kvm@lfdr.de
Delivered-To: lists+kvm@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id F358A61AE9
	for <lists+kvm@lfdr.de>; Mon,  8 Jul 2019 09:07:29 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1729294AbfGHHHX (ORCPT <rfc822;lists+kvm@lfdr.de>);
        Mon, 8 Jul 2019 03:07:23 -0400
Received: from lhrrgout.huawei.com ([185.176.76.210]:33059 "EHLO huawei.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1726962AbfGHHHW (ORCPT <rfc822;kvm@vger.kernel.org>);
        Mon, 8 Jul 2019 03:07:22 -0400
Received: from lhreml709-cah.china.huawei.com (unknown [172.18.7.107])
        by Forcepoint Email with ESMTP id A46054F40AAE701A93A0;
        Mon,  8 Jul 2019 08:07:21 +0100 (IST)
Received: from LHREML524-MBS.china.huawei.com ([169.254.2.154]) by
 lhreml709-cah.china.huawei.com ([10.201.108.32]) with mapi id 14.03.0415.000;
 Mon, 8 Jul 2019 08:07:13 +0100
From:   Shameerali Kolothum Thodi <shameerali.kolothum.thodi@huawei.com>
To:     Auger Eric <eric.auger@redhat.com>,
        "alex.williamson@redhat.com" <alex.williamson@redhat.com>
CC:     "kvm@vger.kernel.org" <kvm@vger.kernel.org>,
        "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
        "iommu@lists.linux-foundation.org" <iommu@lists.linux-foundation.org>,
        Linuxarm <linuxarm@huawei.com>,
        John Garry <john.garry@huawei.com>,
        "xuwei (O)" <xuwei5@huawei.com>,
        "kevin.tian@intel.com" <kevin.tian@intel.com>
Subject: RE: [PATCH v7 1/6] vfio/type1: Introduce iova list and add iommu
 aperture validity check
Thread-Topic: [PATCH v7 1/6] vfio/type1: Introduce iova list and add iommu
 aperture validity check
Thread-Index: AQHVLDHPKQQdUzHkf0S0a1+iQm67I6a/QOuAgAEcSsA=
Date:   Mon, 8 Jul 2019 07:07:13 +0000
Message-ID: <5FC3163CFD30C246ABAA99954A238FA83F2E19A9@lhreml524-mbs.china.huawei.com>
References: <20190626151248.11776-1-shameerali.kolothum.thodi@huawei.com>
 <20190626151248.11776-2-shameerali.kolothum.thodi@huawei.com>
 <9ae8755a-9a2a-da76-e0c1-0f36f75ec2b3@redhat.com>
In-Reply-To: <9ae8755a-9a2a-da76-e0c1-0f36f75ec2b3@redhat.com>
Accept-Language: en-GB, en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [10.34.206.221]
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-CFilter-Loop: Reflected
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org

SGkgRXJpYywNCg0KPiAtLS0tLU9yaWdpbmFsIE1lc3NhZ2UtLS0tLQ0KPiBGcm9tOiBBdWdlciBF
cmljIFttYWlsdG86ZXJpYy5hdWdlckByZWRoYXQuY29tXQ0KPiBTZW50OiAwNyBKdWx5IDIwMTkg
MTY6MDMNCj4gVG86IFNoYW1lZXJhbGkgS29sb3RodW0gVGhvZGkgPHNoYW1lZXJhbGkua29sb3Ro
dW0udGhvZGlAaHVhd2VpLmNvbT47DQo+IGFsZXgud2lsbGlhbXNvbkByZWRoYXQuY29tOyBwbW9y
ZWxAbGludXgudm5ldC5pYm0uY29tDQo+IENjOiBrdm1Admdlci5rZXJuZWwub3JnOyBsaW51eC1r
ZXJuZWxAdmdlci5rZXJuZWwub3JnOw0KPiBpb21tdUBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9y
ZzsgTGludXhhcm0gPGxpbnV4YXJtQGh1YXdlaS5jb20+OyBKb2huDQo+IEdhcnJ5IDxqb2huLmdh
cnJ5QGh1YXdlaS5jb20+OyB4dXdlaSAoTykgPHh1d2VpNUBodWF3ZWkuY29tPjsNCj4ga2V2aW4u
dGlhbkBpbnRlbC5jb20NCj4gU3ViamVjdDogUmU6IFtQQVRDSCB2NyAxLzZdIHZmaW8vdHlwZTE6
IEludHJvZHVjZSBpb3ZhIGxpc3QgYW5kIGFkZCBpb21tdQ0KPiBhcGVydHVyZSB2YWxpZGl0eSBj
aGVjaw0KPiANCj4gSGkgU2hhbWVlciwNCj4gDQo+IE9uIDYvMjYvMTkgNToxMiBQTSwgU2hhbWVl
ciBLb2xvdGh1bSB3cm90ZToNCj4gPiBUaGlzIGludHJvZHVjZXMgYW4gaW92YSBsaXN0IHRoYXQg
aXMgdmFsaWQgZm9yIGRtYSBtYXBwaW5ncy4gTWFrZQ0KPiA+IHN1cmUgdGhlIG5ldyBpb21tdSBh
cGVydHVyZSB3aW5kb3cgZG9lc24ndCBjb25mbGljdCB3aXRoIHRoZSBjdXJyZW50DQo+ID4gb25l
IG9yIHdpdGggYW55IGV4aXN0aW5nIGRtYSBtYXBwaW5ncyBkdXJpbmcgYXR0YWNoLg0KPiA+DQo+
ID4gU2lnbmVkLW9mZi1ieTogU2hhbWVlciBLb2xvdGh1bSA8c2hhbWVlcmFsaS5rb2xvdGh1bS50
aG9kaUBodWF3ZWkuY29tPg0KPiA+IC0tLQ0KPiA+ICBkcml2ZXJzL3ZmaW8vdmZpb19pb21tdV90
eXBlMS5jIHwgMTgxDQo+ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystDQo+ID4gIDEg
ZmlsZSBjaGFuZ2VkLCAxNzcgaW5zZXJ0aW9ucygrKSwgNCBkZWxldGlvbnMoLSkNCj4gPg0KPiA+
IGRpZmYgLS1naXQgYS9kcml2ZXJzL3ZmaW8vdmZpb19pb21tdV90eXBlMS5jDQo+IGIvZHJpdmVy
cy92ZmlvL3ZmaW9faW9tbXVfdHlwZTEuYw0KPiA+IGluZGV4IGFkZDM0YWRmYWRjNy4uOTcwZDFl
YzA2YWVkIDEwMDY0NA0KPiA+IC0tLSBhL2RyaXZlcnMvdmZpby92ZmlvX2lvbW11X3R5cGUxLmMN
Cj4gPiArKysgYi9kcml2ZXJzL3ZmaW8vdmZpb19pb21tdV90eXBlMS5jDQo+ID4gQEAgLTEsNCAr
MSwzIEBADQo+ID4gLS8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkNCj4g
PiAgLyoNCj4gPiAgICogVkZJTzogSU9NTVUgRE1BIG1hcHBpbmcgc3VwcG9ydCBmb3IgVHlwZTEg
SU9NTVUNCj4gPiAgICoNCj4gPiBAQCAtNjIsNiArNjEsNyBAQCBNT0RVTEVfUEFSTV9ERVNDKGRt
YV9lbnRyeV9saW1pdCwNCj4gPg0KPiA+ICBzdHJ1Y3QgdmZpb19pb21tdSB7DQo+ID4gIAlzdHJ1
Y3QgbGlzdF9oZWFkCWRvbWFpbl9saXN0Ow0KPiA+ICsJc3RydWN0IGxpc3RfaGVhZAlpb3ZhX2xp
c3Q7DQo+ID4gIAlzdHJ1Y3QgdmZpb19kb21haW4JKmV4dGVybmFsX2RvbWFpbjsgLyogZG9tYWlu
IGZvciBleHRlcm5hbCB1c2VyICovDQo+ID4gIAlzdHJ1Y3QgbXV0ZXgJCWxvY2s7DQo+ID4gIAlz
dHJ1Y3QgcmJfcm9vdAkJZG1hX2xpc3Q7DQo+ID4gQEAgLTk3LDYgKzk3LDEyIEBAIHN0cnVjdCB2
ZmlvX2dyb3VwIHsNCj4gPiAgCWJvb2wJCQltZGV2X2dyb3VwOwkvKiBBbiBtZGV2IGdyb3VwICov
DQo+ID4gIH07DQo+ID4NCj4gPiArc3RydWN0IHZmaW9faW92YSB7DQo+ID4gKwlzdHJ1Y3QgbGlz
dF9oZWFkCWxpc3Q7DQo+ID4gKwlkbWFfYWRkcl90CQlzdGFydDsNCj4gPiArCWRtYV9hZGRyX3QJ
CWVuZDsNCj4gPiArfTsNCj4gPiArDQo+ID4gIC8qDQo+ID4gICAqIEd1ZXN0IFJBTSBwaW5uaW5n
IHdvcmtpbmcgc2V0IG9yIERNQSB0YXJnZXQNCj4gPiAgICovDQo+ID4gQEAgLTE0MDEsNiArMTQw
NywxNDYgQEAgc3RhdGljIGludCB2ZmlvX21kZXZfaW9tbXVfZGV2aWNlKHN0cnVjdA0KPiBkZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSkNCj4gPiAgCXJldHVybiAwOw0KPiA+ICB9DQo+ID4NCj4gPiAr
LyoNCj4gPiArICogVGhpcyBpcyBhIGhlbHBlciBmdW5jdGlvbiB0byBpbnNlcnQgYW4gYWRkcmVz
cyByYW5nZSB0byBpb3ZhIGxpc3QuDQo+ID4gKyAqIFRoZSBsaXN0IHN0YXJ0cyB3aXRoIGEgc2lu
Z2xlIGVudHJ5IGNvcnJlc3BvbmRpbmcgdG8gdGhlIElPTU1VDQo+IFRoZSBsaXN0IGlzIGluaXRp
YWxseSBjcmVhdGVkIHdpdGggYSBzaW5nbGUgZW50cnkgLi4vLi4NCj4gPiArICogZG9tYWluIGdl
b21ldHJ5IHRvIHdoaWNoIHRoZSBkZXZpY2UgZ3JvdXAgaXMgYXR0YWNoZWQuIFRoZSBsaXN0DQo+
ID4gKyAqIGFwZXJ0dXJlIGdldHMgbW9kaWZpZWQgd2hlbiBhIG5ldyBkb21haW4gaXMgYWRkZWQg
dG8gdGhlIGNvbnRhaW5lcg0KPiA+ICsgKiBpZiB0aGUgbmV3IGFwZXJ0dXJlIGRvZXNuJ3QgY29u
ZmxpY3Qgd2l0aCB0aGUgY3VycmVudCBvbmUgb3Igd2l0aA0KPiA+ICsgKiBhbnkgZXhpc3Rpbmcg
ZG1hIG1hcHBpbmdzLiBUaGUgbGlzdCBpcyBhbHNvIG1vZGlmaWVkIHRvIGV4Y2x1ZGUNCj4gPiAr
ICogYW55IHJlc2VydmVkIHJlZ2lvbnMgYXNzb2NpYXRlZCB3aXRoIHRoZSBkZXZpY2UgZ3JvdXAu
DQo+ID4gKyAqLw0KPiA+ICtzdGF0aWMgaW50IHZmaW9faW9tbXVfaW92YV9pbnNlcnQoc3RydWN0
IGxpc3RfaGVhZCAqaGVhZCwNCj4gPiArCQkJCSAgZG1hX2FkZHJfdCBzdGFydCwgZG1hX2FkZHJf
dCBlbmQpDQo+ID4gK3sNCj4gPiArCXN0cnVjdCB2ZmlvX2lvdmEgKnJlZ2lvbjsNCj4gPiArDQo+
ID4gKwlyZWdpb24gPSBrbWFsbG9jKHNpemVvZigqcmVnaW9uKSwgR0ZQX0tFUk5FTCk7DQo+ID4g
KwlpZiAoIXJlZ2lvbikNCj4gPiArCQlyZXR1cm4gLUVOT01FTTsNCj4gPiArDQo+ID4gKwlJTklU
X0xJU1RfSEVBRCgmcmVnaW9uLT5saXN0KTsNCj4gPiArCXJlZ2lvbi0+c3RhcnQgPSBzdGFydDsN
Cj4gPiArCXJlZ2lvbi0+ZW5kID0gZW5kOw0KPiA+ICsNCj4gPiArCWxpc3RfYWRkX3RhaWwoJnJl
Z2lvbi0+bGlzdCwgaGVhZCk7DQo+ID4gKwlyZXR1cm4gMDsNCj4gPiArfQ0KPiA+ICsNCj4gPiAr
LyoNCj4gPiArICogQ2hlY2sgdGhlIG5ldyBpb21tdSBhcGVydHVyZSBjb25mbGljdHMgd2l0aCBl
eGlzdGluZyBhcGVyIG9yIHdpdGggYW55DQo+ID4gKyAqIGV4aXN0aW5nIGRtYSBtYXBwaW5ncy4N
Cj4gPiArICovDQo+ID4gK3N0YXRpYyBib29sIHZmaW9faW9tbXVfYXBlcl9jb25mbGljdChzdHJ1
Y3QgdmZpb19pb21tdSAqaW9tbXUsDQo+ID4gKwkJCQkgICAgIGRtYV9hZGRyX3Qgc3RhcnQsIGRt
YV9hZGRyX3QgZW5kKQ0KPiA+ICt7DQo+ID4gKwlzdHJ1Y3QgdmZpb19pb3ZhICpmaXJzdCwgKmxh
c3Q7DQo+ID4gKwlzdHJ1Y3QgbGlzdF9oZWFkICppb3ZhID0gJmlvbW11LT5pb3ZhX2xpc3Q7DQo+
ID4gKw0KPiA+ICsJaWYgKGxpc3RfZW1wdHkoaW92YSkpDQo+ID4gKwkJcmV0dXJuIGZhbHNlOw0K
PiA+ICsNCj4gPiArCS8qIERpc2pvaW50IHNldHMsIHJldHVybiBjb25mbGljdCAqLw0KPiA+ICsJ
Zmlyc3QgPSBsaXN0X2ZpcnN0X2VudHJ5KGlvdmEsIHN0cnVjdCB2ZmlvX2lvdmEsIGxpc3QpOw0K
PiA+ICsJbGFzdCA9IGxpc3RfbGFzdF9lbnRyeShpb3ZhLCBzdHJ1Y3QgdmZpb19pb3ZhLCBsaXN0
KTsNCj4gPiArCWlmIChzdGFydCA+IGxhc3QtPmVuZCB8fCBlbmQgPCBmaXJzdC0+c3RhcnQpDQo+
ID4gKwkJcmV0dXJuIHRydWU7DQo+ID4gKw0KPiA+ICsJLyogQ2hlY2sgZm9yIGFueSBleGlzdGlu
ZyBkbWEgbWFwcGluZ3Mgb3V0c2lkZSB0aGUgbmV3IHN0YXJ0ICovDQo+IHMvb3V0c2lkZS9iZWxv
dw0KPiA+ICsJaWYgKHN0YXJ0ID4gZmlyc3QtPnN0YXJ0KSB7DQo+ID4gKwkJaWYgKHZmaW9fZmlu
ZF9kbWEoaW9tbXUsIGZpcnN0LT5zdGFydCwgc3RhcnQgLSBmaXJzdC0+c3RhcnQpKQ0KPiA+ICsJ
CQlyZXR1cm4gdHJ1ZTsNCj4gPiArCX0NCj4gPiArDQo+ID4gKwkvKiBDaGVjayBmb3IgYW55IGV4
aXN0aW5nIGRtYSBtYXBwaW5ncyBvdXRzaWRlIHRoZSBuZXcgZW5kICovDQo+IHMvb3V0c2lkZS9i
ZXlvbmQNCj4gPiArCWlmIChlbmQgPCBsYXN0LT5lbmQpIHsNCj4gPiArCQlpZiAodmZpb19maW5k
X2RtYShpb21tdSwgZW5kICsgMSwgbGFzdC0+ZW5kIC0gZW5kKSkNCj4gPiArCQkJcmV0dXJuIHRy
dWU7DQo+ID4gKwl9DQo+ID4gKw0KPiA+ICsJcmV0dXJuIGZhbHNlOw0KPiA+ICt9DQo+ID4gKw0K
PiA+ICsvKg0KPiA+ICsgKiBSZXNpemUgaW9tbXUgaW92YSBhcGVydHVyZSB3aW5kb3cuIFRoaXMg
aXMgY2FsbGVkIG9ubHkgaWYgdGhlIG5ldw0KPiA+ICsgKiBhcGVydHVyZSBoYXMgbm8gY29uZmxp
Y3Qgd2l0aCBleGlzdGluZyBhcGVydHVyZSBhbmQgZG1hIG1hcHBpbmdzLg0KPiA+ICsgKi8NCj4g
PiArc3RhdGljIGludCB2ZmlvX2lvbW11X2FwZXJfcmVzaXplKHN0cnVjdCBsaXN0X2hlYWQgKmlv
dmEsDQo+ID4gKwkJCQkgIGRtYV9hZGRyX3Qgc3RhcnQsIGRtYV9hZGRyX3QgZW5kKQ0KPiA+ICt7
DQo+ID4gKwlzdHJ1Y3QgdmZpb19pb3ZhICpub2RlLCAqbmV4dDsNCj4gPiArDQo+ID4gKwlpZiAo
bGlzdF9lbXB0eShpb3ZhKSkNCj4gPiArCQlyZXR1cm4gdmZpb19pb21tdV9pb3ZhX2luc2VydChp
b3ZhLCBzdGFydCwgZW5kKTsNCj4gPiArDQo+ID4gKwkvKiBBZGp1c3QgaW92YSBsaXN0IHN0YXJ0
ICovDQo+ID4gKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUobm9kZSwgbmV4dCwgaW92YSwgbGlz
dCkgew0KPiA+ICsJCWlmIChzdGFydCA8IG5vZGUtPnN0YXJ0KQ0KPiA+ICsJCQlicmVhazsNCj4g
PiArCQlpZiAoc3RhcnQgPj0gbm9kZS0+c3RhcnQgJiYgc3RhcnQgPCBub2RlLT5lbmQpIHsNCj4g
PiArCQkJbm9kZS0+c3RhcnQgPSBzdGFydDsNCj4gPiArCQkJYnJlYWs7DQo+ID4gKwkJfQ0KPiA+
ICsJCS8qIERlbGV0ZSBub2RlcyBiZWZvcmUgbmV3IHN0YXJ0ICovDQo+ID4gKwkJbGlzdF9kZWwo
Jm5vZGUtPmxpc3QpOw0KPiA+ICsJCWtmcmVlKG5vZGUpOw0KPiA+ICsJfQ0KPiA+ICsNCj4gPiAr
CS8qIEFkanVzdCBpb3ZhIGxpc3QgZW5kICovDQo+ID4gKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3Nh
ZmUobm9kZSwgbmV4dCwgaW92YSwgbGlzdCkgew0KPiA+ICsJCWlmIChlbmQgPiBub2RlLT5lbmQp
DQo+ID4gKwkJCWNvbnRpbnVlOw0KPiA+ICsJCWlmIChlbmQgPiBub2RlLT5zdGFydCAmJiBlbmQg
PD0gbm9kZS0+ZW5kKSB7DQo+ID4gKwkJCW5vZGUtPmVuZCA9IGVuZDsNCj4gPiArCQkJY29udGlu
dWU7DQo+ID4gKwkJfQ0KPiA+ICsJCS8qIERlbGV0ZSBub2RlcyBhZnRlciBuZXcgZW5kICovDQo+
ID4gKwkJbGlzdF9kZWwoJm5vZGUtPmxpc3QpOw0KPiA+ICsJCWtmcmVlKG5vZGUpOw0KPiA+ICsJ
fQ0KPiA+ICsNCj4gPiArCXJldHVybiAwOw0KPiA+ICt9DQo+ID4gKw0KPiA+ICtzdGF0aWMgdm9p
ZCB2ZmlvX2lvbW11X2lvdmFfZnJlZShzdHJ1Y3QgbGlzdF9oZWFkICppb3ZhKQ0KPiA+ICt7DQo+
ID4gKwlzdHJ1Y3QgdmZpb19pb3ZhICpuLCAqbmV4dDsNCj4gPiArDQo+ID4gKwlsaXN0X2Zvcl9l
YWNoX2VudHJ5X3NhZmUobiwgbmV4dCwgaW92YSwgbGlzdCkgew0KPiA+ICsJCWxpc3RfZGVsKCZu
LT5saXN0KTsNCj4gPiArCQlrZnJlZShuKTsNCj4gPiArCX0NCj4gPiArfQ0KPiA+ICsNCj4gPiAr
c3RhdGljIGludCB2ZmlvX2lvbW11X2lvdmFfZ2V0X2NvcHkoc3RydWN0IHZmaW9faW9tbXUgKmlv
bW11LA0KPiA+ICsJCQkJICAgIHN0cnVjdCBsaXN0X2hlYWQgKmlvdmFfY29weSkNCj4gPiArew0K
PiA+ICsJc3RydWN0IGxpc3RfaGVhZCAqaW92YSA9ICZpb21tdS0+aW92YV9saXN0Ow0KPiA+ICsJ
c3RydWN0IHZmaW9faW92YSAqbjsNCj4gPiArCWludCByZXQ7DQo+ID4gKw0KPiA+ICsJbGlzdF9m
b3JfZWFjaF9lbnRyeShuLCBpb3ZhLCBsaXN0KSB7DQo+ID4gKwkJcmV0ID0gdmZpb19pb21tdV9p
b3ZhX2luc2VydChpb3ZhX2NvcHksIG4tPnN0YXJ0LCBuLT5lbmQpOw0KPiA+ICsJCWlmIChyZXQp
DQo+ID4gKwkJCWdvdG8gb3V0X2ZyZWU7DQo+ID4gKwl9DQo+ID4gKw0KPiA+ICsJcmV0dXJuIDA7
DQo+ID4gKw0KPiA+ICtvdXRfZnJlZToNCj4gPiArCXZmaW9faW9tbXVfaW92YV9mcmVlKGlvdmFf
Y29weSk7DQo+ID4gKwlyZXR1cm4gcmV0Ow0KPiA+ICt9DQo+ID4gKw0KPiA+ICtzdGF0aWMgdm9p
ZCB2ZmlvX2lvbW11X2lvdmFfaW5zZXJ0X2NvcHkoc3RydWN0IHZmaW9faW9tbXUgKmlvbW11LA0K
PiA+ICsJCQkJCXN0cnVjdCBsaXN0X2hlYWQgKmlvdmFfY29weSkNCj4gPiArew0KPiA+ICsJc3Ry
dWN0IGxpc3RfaGVhZCAqaW92YSA9ICZpb21tdS0+aW92YV9saXN0Ow0KPiA+ICsNCj4gPiArCXZm
aW9faW9tbXVfaW92YV9mcmVlKGlvdmEpOw0KPiA+ICsNCj4gPiArCWxpc3Rfc3BsaWNlX3RhaWwo
aW92YV9jb3B5LCBpb3ZhKTsNCj4gPiArfQ0KPiA+ICBzdGF0aWMgaW50IHZmaW9faW9tbXVfdHlw
ZTFfYXR0YWNoX2dyb3VwKHZvaWQgKmlvbW11X2RhdGEsDQo+ID4gIAkJCQkJIHN0cnVjdCBpb21t
dV9ncm91cCAqaW9tbXVfZ3JvdXApDQo+ID4gIHsNCj4gPiBAQCAtMTQxMSw2ICsxNTU3LDggQEAg
c3RhdGljIGludCB2ZmlvX2lvbW11X3R5cGUxX2F0dGFjaF9ncm91cCh2b2lkDQo+ICppb21tdV9k
YXRhLA0KPiA+ICAJaW50IHJldDsNCj4gPiAgCWJvb2wgcmVzdl9tc2ksIG1zaV9yZW1hcDsNCj4g
PiAgCXBoeXNfYWRkcl90IHJlc3ZfbXNpX2Jhc2U7DQo+ID4gKwlzdHJ1Y3QgaW9tbXVfZG9tYWlu
X2dlb21ldHJ5IGdlbzsNCj4gPiArCUxJU1RfSEVBRChpb3ZhX2NvcHkpOw0KPiA+DQo+ID4gIAlt
dXRleF9sb2NrKCZpb21tdS0+bG9jayk7DQo+ID4NCj4gPiBAQCAtMTQ4Nyw2ICsxNjM1LDI1IEBA
IHN0YXRpYyBpbnQgdmZpb19pb21tdV90eXBlMV9hdHRhY2hfZ3JvdXAodm9pZA0KPiAqaW9tbXVf
ZGF0YSwNCj4gPiAgCWlmIChyZXQpDQo+ID4gIAkJZ290byBvdXRfZG9tYWluOw0KPiA+DQo+ID4g
KwkvKiBHZXQgYXBlcnR1cmUgaW5mbyAqLw0KPiA+ICsJaW9tbXVfZG9tYWluX2dldF9hdHRyKGRv
bWFpbi0+ZG9tYWluLCBET01BSU5fQVRUUl9HRU9NRVRSWSwNCj4gJmdlbyk7DQo+ID4gKw0KPiA+
ICsJaWYgKHZmaW9faW9tbXVfYXBlcl9jb25mbGljdChpb21tdSwgZ2VvLmFwZXJ0dXJlX3N0YXJ0
LA0KPiA+ICsJCQkJICAgICBnZW8uYXBlcnR1cmVfZW5kKSkgew0KPiA+ICsJCXJldCA9IC1FSU5W
QUw7DQo+ID4gKwkJZ290byBvdXRfZGV0YWNoOw0KPiA+ICsJfQ0KPiA+ICsNCj4gPiArCS8qIEdl
dCBhIGNvcHkgb2YgdGhlIGN1cnJlbnQgaW92YSBsaXN0IGFuZCB3b3JrIG9uIGl0ICovDQo+IEF0
IHRoaXMgc3RhZ2Ugb2YgdGhlIHJlYWRpbmcgaXQgaXMgbm90IG9idmlvdXMgd2h5IHlvdSBuZWVk
IGEgY29weSBvZg0KPiB0aGUgbGlzdC4gcmF0aW9uYWxlIGNhbiBiZSBmb3VuZCB3aGVuIHJlYWRp
bmcgZnVydGhlciBvciBpbiB0aGUgc2VyaWVzDQo+IGhpc3RvcnkgKCJVc2Ugb2YgaW92YSBsaXN0
IGNvcHkgc28gdGhhdCBvcmlnaW5hbCBpcyBub3QgYWx0ZXJlZCBpbiBjYXNlDQo+IG9mIGZhaWx1
cmUiKS4NCj4gDQo+IEFkZGluZyBhIGNvbW1lbnQgaW4gdGhlIGNvZGUgd291bGQgYmUgdXNlZnVs
IEkgdGhpbmsuDQoNCk9rLiBUaGF0IG1ha2VzIHNlbnNlLiBJIHdpbGwgYWRkcmVzcyB0aGlzIGFu
ZCBhbGwgb3RoZXIgbWlub3IgY29tbWVudHMNCnlvdSBoYWQgb24gb3RoZXIgcGF0Y2hlcyBpbiBu
ZXh0IHJldmlzaW9uLg0KDQpUaGFua3MsDQpTaGFtZWVyDQoNCj4gVGhhbmtzDQo+IA0KPiBFcmlj
DQo+IA0KPiA+ICsJcmV0ID0gdmZpb19pb21tdV9pb3ZhX2dldF9jb3B5KGlvbW11LCAmaW92YV9j
b3B5KTsNCj4gPiArCWlmIChyZXQpDQo+ID4gKwkJZ290byBvdXRfZGV0YWNoOw0KPiA+ICsNCj4g
PiArCXJldCA9IHZmaW9faW9tbXVfYXBlcl9yZXNpemUoJmlvdmFfY29weSwgZ2VvLmFwZXJ0dXJl
X3N0YXJ0LA0KPiA+ICsJCQkJICAgICBnZW8uYXBlcnR1cmVfZW5kKTsNCj4gPiArCWlmIChyZXQp
DQo+ID4gKwkJZ290byBvdXRfZGV0YWNoOw0KPiA+ICsNCj4gPiAgCXJlc3ZfbXNpID0gdmZpb19p
b21tdV9oYXNfc3dfbXNpKGlvbW11X2dyb3VwLCAmcmVzdl9tc2lfYmFzZSk7DQo+ID4NCj4gPiAg
CUlOSVRfTElTVF9IRUFEKCZkb21haW4tPmdyb3VwX2xpc3QpOw0KPiA+IEBAIC0xNTIwLDggKzE2
ODcsNyBAQCBzdGF0aWMgaW50IHZmaW9faW9tbXVfdHlwZTFfYXR0YWNoX2dyb3VwKHZvaWQNCj4g
KmlvbW11X2RhdGEsDQo+ID4gIAkJCQlsaXN0X2FkZCgmZ3JvdXAtPm5leHQsICZkLT5ncm91cF9s
aXN0KTsNCj4gPiAgCQkJCWlvbW11X2RvbWFpbl9mcmVlKGRvbWFpbi0+ZG9tYWluKTsNCj4gPiAg
CQkJCWtmcmVlKGRvbWFpbik7DQo+ID4gLQkJCQltdXRleF91bmxvY2soJmlvbW11LT5sb2NrKTsN
Cj4gPiAtCQkJCXJldHVybiAwOw0KPiA+ICsJCQkJZ290byBkb25lOw0KPiA+ICAJCQl9DQo+ID4N
Cj4gPiAgCQkJcmV0ID0gdmZpb19pb21tdV9hdHRhY2hfZ3JvdXAoZG9tYWluLCBncm91cCk7DQo+
ID4gQEAgLTE1NDQsNyArMTcxMCw5IEBAIHN0YXRpYyBpbnQgdmZpb19pb21tdV90eXBlMV9hdHRh
Y2hfZ3JvdXAodm9pZA0KPiAqaW9tbXVfZGF0YSwNCj4gPiAgCX0NCj4gPg0KPiA+ICAJbGlzdF9h
ZGQoJmRvbWFpbi0+bmV4dCwgJmlvbW11LT5kb21haW5fbGlzdCk7DQo+ID4gLQ0KPiA+ICtkb25l
Og0KPiA+ICsJLyogRGVsZXRlIHRoZSBvbGQgb25lIGFuZCBpbnNlcnQgbmV3IGlvdmEgbGlzdCAq
Lw0KPiA+ICsJdmZpb19pb21tdV9pb3ZhX2luc2VydF9jb3B5KGlvbW11LCAmaW92YV9jb3B5KTsN
Cj4gPiAgCW11dGV4X3VubG9jaygmaW9tbXUtPmxvY2spOw0KPiA+DQo+ID4gIAlyZXR1cm4gMDsN
Cj4gPiBAQCAtMTU1Myw2ICsxNzIxLDcgQEAgc3RhdGljIGludCB2ZmlvX2lvbW11X3R5cGUxX2F0
dGFjaF9ncm91cCh2b2lkDQo+ICppb21tdV9kYXRhLA0KPiA+ICAJdmZpb19pb21tdV9kZXRhY2hf
Z3JvdXAoZG9tYWluLCBncm91cCk7DQo+ID4gIG91dF9kb21haW46DQo+ID4gIAlpb21tdV9kb21h
aW5fZnJlZShkb21haW4tPmRvbWFpbik7DQo+ID4gKwl2ZmlvX2lvbW11X2lvdmFfZnJlZSgmaW92
YV9jb3B5KTsNCj4gPiAgb3V0X2ZyZWU6DQo+ID4gIAlrZnJlZShkb21haW4pOw0KPiA+ICAJa2Zy
ZWUoZ3JvdXApOw0KPiA+IEBAIC0xNjkyLDYgKzE4NjEsNyBAQCBzdGF0aWMgdm9pZCAqdmZpb19p
b21tdV90eXBlMV9vcGVuKHVuc2lnbmVkDQo+IGxvbmcgYXJnKQ0KPiA+ICAJfQ0KPiA+DQo+ID4g
IAlJTklUX0xJU1RfSEVBRCgmaW9tbXUtPmRvbWFpbl9saXN0KTsNCj4gPiArCUlOSVRfTElTVF9I
RUFEKCZpb21tdS0+aW92YV9saXN0KTsNCj4gPiAgCWlvbW11LT5kbWFfbGlzdCA9IFJCX1JPT1Q7
DQo+ID4gIAlpb21tdS0+ZG1hX2F2YWlsID0gZG1hX2VudHJ5X2xpbWl0Ow0KPiA+ICAJbXV0ZXhf
aW5pdCgmaW9tbXUtPmxvY2spOw0KPiA+IEBAIC0xNzM1LDYgKzE5MDUsOSBAQCBzdGF0aWMgdm9p
ZCB2ZmlvX2lvbW11X3R5cGUxX3JlbGVhc2Uodm9pZA0KPiAqaW9tbXVfZGF0YSkNCj4gPiAgCQls
aXN0X2RlbCgmZG9tYWluLT5uZXh0KTsNCj4gPiAgCQlrZnJlZShkb21haW4pOw0KPiA+ICAJfQ0K
PiA+ICsNCj4gPiArCXZmaW9faW9tbXVfaW92YV9mcmVlKCZpb21tdS0+aW92YV9saXN0KTsNCj4g
PiArDQo+ID4gIAlrZnJlZShpb21tdSk7DQo+ID4gIH0NCj4gPg0KPiA+DQo=
