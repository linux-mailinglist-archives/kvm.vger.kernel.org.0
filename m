Return-Path: <kvm-owner@vger.kernel.org>
X-Original-To: lists+kvm@lfdr.de
Delivered-To: lists+kvm@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 286D111C93C
	for <lists+kvm@lfdr.de>; Thu, 12 Dec 2019 10:35:52 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1728369AbfLLJfL (ORCPT <rfc822;lists+kvm@lfdr.de>);
        Thu, 12 Dec 2019 04:35:11 -0500
Received: from smtp-fw-33001.amazon.com ([207.171.190.10]:20462 "EHLO
        smtp-fw-33001.amazon.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1728230AbfLLJfL (ORCPT <rfc822;kvm@vger.kernel.org>);
        Thu, 12 Dec 2019 04:35:11 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
  d=amazon.de; i=@amazon.de; q=dns/txt; s=amazon201209;
  t=1576143307; x=1607679307;
  h=subject:to:cc:references:from:message-id:date:
   mime-version:in-reply-to:content-transfer-encoding;
  bh=Fpvein8sJLEOgQdjhS83ACkcjT11bTb9Lz0Qd/PksJQ=;
  b=AHjClA60n1/K0nQPGTc2Y8WS0vw2O8NqRqyN6T+wciNfBbjx+2PRMkma
   9nARKZi8r9we1T0ab1acGha0GxWO3/P068JIATGnwWEe1WDW3sQ+Z6qcQ
   wOonI732EwZfxl1D9TP/FxkHPGA8SLScsg8/DigT5pc83sOlSlnf4+zTw
   w=;
IronPort-SDR: +FtMMa6WAoc2gQyuJYk20jFolJq9HGRqodqQPboIqRTaL+4VXCZIhmA8o4DIDwSOAqTR+iFhQz
 nrRhcgmTOW8Q==
X-IronPort-AV: E=Sophos;i="5.69,305,1571702400"; 
   d="scan'208";a="14478511"
Received: from sea32-co-svc-lb4-vlan3.sea.corp.amazon.com (HELO email-inbound-relay-1e-17c49630.us-east-1.amazon.com) ([10.47.23.38])
  by smtp-border-fw-out-33001.sea14.amazon.com with ESMTP; 12 Dec 2019 09:34:55 +0000
Received: from EX13MTAUWC001.ant.amazon.com (iad55-ws-svc-p15-lb9-vlan3.iad.amazon.com [10.40.159.166])
        by email-inbound-relay-1e-17c49630.us-east-1.amazon.com (Postfix) with ESMTPS id CBD01A25A6;
        Thu, 12 Dec 2019 09:34:53 +0000 (UTC)
Received: from EX13D20UWC001.ant.amazon.com (10.43.162.244) by
 EX13MTAUWC001.ant.amazon.com (10.43.162.135) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Thu, 12 Dec 2019 09:34:52 +0000
Received: from 38f9d3867b82.ant.amazon.com (10.43.160.109) by
 EX13D20UWC001.ant.amazon.com (10.43.162.244) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Thu, 12 Dec 2019 09:34:51 +0000
Subject: Re: [PATCH v2] kvm: Refactor handling of VM debugfs files
To:     Milan Pandurov <milanpa@amazon.de>, <kvm@vger.kernel.org>
CC:     <pbonzini@redhat.com>, <rkrcmar@redhat.com>,
        <borntraeger@de.ibm.com>
References: <20191212092206.7732-1-milanpa@amazon.de>
From:   Alexander Graf <graf@amazon.de>
Message-ID: <26e0da0e-6509-f359-5628-20c33820267c@amazon.de>
Date:   Thu, 12 Dec 2019 10:34:48 +0100
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:60.0)
 Gecko/20100101 Thunderbird/60.9.1
MIME-Version: 1.0
In-Reply-To: <20191212092206.7732-1-milanpa@amazon.de>
Content-Language: en-US
X-Originating-IP: [10.43.160.109]
X-ClientProxiedBy: EX13D28UWC003.ant.amazon.com (10.43.162.48) To
 EX13D20UWC001.ant.amazon.com (10.43.162.244)
Content-Type: text/plain; charset="utf-8"; format="flowed"
Content-Transfer-Encoding: base64
Sender: kvm-owner@vger.kernel.org
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org

CgpPbiAxMi4xMi4xOSAxMToyMiwgTWlsYW4gUGFuZHVyb3Ygd3JvdGU6Cj4gV2UgY2FuIHN0b3Jl
IHJlZmVyZW5jZSB0byBrdm1fc3RhdHNfZGVidWdmc19pdGVtIGluc3RlYWQgb2YgY29weWluZwo+
IGl0cyB2YWx1ZXMgdG8ga3ZtX3N0YXRfZGF0YS4KPiBUaGlzIGFsbG93cyB1cyB0byByZW1vdmUg
ZHVwbGljYXRlZCBjb2RlIGFuZCB1c2FnZSBvZiB0ZW1wb3JhcnkKPiBrdm1fc3RhdF9kYXRhIGlu
c2lkZSB2bV9zdGF0X2dldCBldCBhbC4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBNaWxhbiBQYW5kdXJv
diA8bWlsYW5wYUBhbWF6b24uZGU+Cj4gCj4gLS0tCj4gdjEgLT4gdjI6Cj4gICAtIGZpeCBjb21w
aWxlIGlzc3Vlcwo+ICAgLSBhZGRyZXNzIGNvbW1lbnRzCj4gLS0tCj4gICBpbmNsdWRlL2xpbnV4
L2t2bV9ob3N0LmggfCAgIDcgKy0KPiAgIHZpcnQva3ZtL2t2bV9tYWluLmMgICAgICB8IDE1NCAr
KysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0KPiAgIDIgZmlsZXMgY2hhbmdl
ZCwgOTAgaW5zZXJ0aW9ucygrKSwgNzEgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL2lu
Y2x1ZGUvbGludXgva3ZtX2hvc3QuaCBiL2luY2x1ZGUvbGludXgva3ZtX2hvc3QuaAo+IGluZGV4
IDdlZDFlMmY4NjQxZS4uZDNmMmMwZWFlODU3IDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvbGludXgv
a3ZtX2hvc3QuaAo+ICsrKyBiL2luY2x1ZGUvbGludXgva3ZtX2hvc3QuaAo+IEBAIC0xMTA5LDkg
KzExMDksOCBAQCBlbnVtIGt2bV9zdGF0X2tpbmQgewo+ICAgfTsKPiAgIAo+ICAgc3RydWN0IGt2
bV9zdGF0X2RhdGEgewo+IC0JaW50IG9mZnNldDsKPiAtCWludCBtb2RlOwo+ICAgCXN0cnVjdCBr
dm0gKmt2bTsKPiArCXN0cnVjdCBrdm1fc3RhdHNfZGVidWdmc19pdGVtICpkYmdmc19pdGVtOwo+
ICAgfTsKPiAgIAo+ICAgc3RydWN0IGt2bV9zdGF0c19kZWJ1Z2ZzX2l0ZW0gewo+IEBAIC0xMTIw
LDYgKzExMTksMTAgQEAgc3RydWN0IGt2bV9zdGF0c19kZWJ1Z2ZzX2l0ZW0gewo+ICAgCWVudW0g
a3ZtX3N0YXRfa2luZCBraW5kOwo+ICAgCWludCBtb2RlOwo+ICAgfTsKPiArCj4gKyNkZWZpbmUg
S1ZNX0RCR0ZTX0dFVF9NT0RFKGRiZ2ZzX2l0ZW0pICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBcCj4gKwkoKGRiZ2ZzX2l0ZW0pLT5tb2RlID8gKGRiZ2ZzX2l0ZW0pLT5t
b2RlIDogMDY0NCkKPiArCj4gICBleHRlcm4gc3RydWN0IGt2bV9zdGF0c19kZWJ1Z2ZzX2l0ZW0g
ZGVidWdmc19lbnRyaWVzW107Cj4gICBleHRlcm4gc3RydWN0IGRlbnRyeSAqa3ZtX2RlYnVnZnNf
ZGlyOwo+ICAgCj4gZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2t2bV9tYWluLmMgYi92aXJ0L2t2bS9r
dm1fbWFpbi5jCj4gaW5kZXggMDAyNjgyOTBkY2JkLi41ZDJlOGFkNDA5NzUgMTAwNjQ0Cj4gLS0t
IGEvdmlydC9rdm0va3ZtX21haW4uYwo+ICsrKyBiL3ZpcnQva3ZtL2t2bV9tYWluLmMKPiBAQCAt
MTEzLDcgKzExMyw3IEBAIHN0cnVjdCBkZW50cnkgKmt2bV9kZWJ1Z2ZzX2RpcjsKPiAgIEVYUE9S
VF9TWU1CT0xfR1BMKGt2bV9kZWJ1Z2ZzX2Rpcik7Cj4gICAKPiAgIHN0YXRpYyBpbnQga3ZtX2Rl
YnVnZnNfbnVtX2VudHJpZXM7Cj4gLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25z
ICpzdGF0X2ZvcHNfcGVyX3ZtW107Cj4gK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRp
b25zIHN0YXRfZm9wc19wZXJfdm07Cj4gICAKPiAgIHN0YXRpYyBsb25nIGt2bV92Y3B1X2lvY3Rs
KHN0cnVjdCBmaWxlICpmaWxlLCB1bnNpZ25lZCBpbnQgaW9jdGwsCj4gICAJCQkgICB1bnNpZ25l
ZCBsb25nIGFyZyk7Cj4gQEAgLTY1MCwxMSArNjUwLDExIEBAIHN0YXRpYyBpbnQga3ZtX2NyZWF0
ZV92bV9kZWJ1Z2ZzKHN0cnVjdCBrdm0gKmt2bSwgaW50IGZkKQo+ICAgCQkJcmV0dXJuIC1FTk9N
RU07Cj4gICAKPiAgIAkJc3RhdF9kYXRhLT5rdm0gPSBrdm07Cj4gLQkJc3RhdF9kYXRhLT5vZmZz
ZXQgPSBwLT5vZmZzZXQ7Cj4gLQkJc3RhdF9kYXRhLT5tb2RlID0gcC0+bW9kZSA/IHAtPm1vZGUg
OiAwNjQ0Owo+ICsJCXN0YXRfZGF0YS0+ZGJnZnNfaXRlbSA9IHA7Cj4gICAJCWt2bS0+ZGVidWdm
c19zdGF0X2RhdGFbcCAtIGRlYnVnZnNfZW50cmllc10gPSBzdGF0X2RhdGE7Cj4gLQkJZGVidWdm
c19jcmVhdGVfZmlsZShwLT5uYW1lLCBzdGF0X2RhdGEtPm1vZGUsIGt2bS0+ZGVidWdmc19kZW50
cnksCj4gLQkJCQkgICAgc3RhdF9kYXRhLCBzdGF0X2ZvcHNfcGVyX3ZtW3AtPmtpbmRdKTsKPiAr
CQlkZWJ1Z2ZzX2NyZWF0ZV9maWxlKHAtPm5hbWUsIEtWTV9EQkdGU19HRVRfTU9ERShwKSwKPiAr
CQkJCSAgICBrdm0tPmRlYnVnZnNfZGVudHJ5LCBzdGF0X2RhdGEsCj4gKwkJCQkgICAgJnN0YXRf
Zm9wc19wZXJfdm0pOwo+ICAgCX0KPiAgIAlyZXR1cm4gMDsKPiAgIH0KPiBAQCAtNDAxMyw4ICs0
MDEzLDkgQEAgc3RhdGljIGludCBrdm1fZGVidWdmc19vcGVuKHN0cnVjdCBpbm9kZSAqaW5vZGUs
IHN0cnVjdCBmaWxlICpmaWxlLAo+ICAgCQlyZXR1cm4gLUVOT0VOVDsKPiAgIAo+ICAgCWlmIChz
aW1wbGVfYXR0cl9vcGVuKGlub2RlLCBmaWxlLCBnZXQsCj4gLQkJCSAgICAgc3RhdF9kYXRhLT5t
b2RlICYgU19JV1VHTyA/IHNldCA6IE5VTEwsCj4gLQkJCSAgICAgZm10KSkgewo+ICsJCSAgICBL
Vk1fREJHRlNfR0VUX01PREUoc3RhdF9kYXRhLT5kYmdmc19pdGVtKSAmIDAyMjIKCldoeSBkbyB5
b3UgY2hhbmdlIHRoZSBtYXNrIGZyb20gU19JV1VHTyB0byAwMjIyPwoKPiArCQkgICAgPyBzZXQg
OiBOVUxMLAo+ICsJCSAgICBmbXQpKSB7Cj4gICAJCWt2bV9wdXRfa3ZtKHN0YXRfZGF0YS0+a3Zt
KTsKPiAgIAkJcmV0dXJuIC1FTk9NRU07Cj4gICAJfQo+IEBAIC00MDMzLDEwNSArNDAzNCwxMjcg
QEAgc3RhdGljIGludCBrdm1fZGVidWdmc19yZWxlYXNlKHN0cnVjdCBpbm9kZSAqaW5vZGUsIHN0
cnVjdCBmaWxlICpmaWxlKQo+ICAgCXJldHVybiAwOwo+ICAgfQo+ICAgCj4gLXN0YXRpYyBpbnQg
dm1fc3RhdF9nZXRfcGVyX3ZtKHZvaWQgKmRhdGEsIHU2NCAqdmFsKQo+ICtzdGF0aWMgaW50IGt2
bV9nZXRfc3RhdF9wZXJfdm0oc3RydWN0IGt2bSAqa3ZtLCBzaXplX3Qgb2Zmc2V0LCB1NjQgKnZh
bCkKPiAgIHsKPiAtCXN0cnVjdCBrdm1fc3RhdF9kYXRhICpzdGF0X2RhdGEgPSAoc3RydWN0IGt2
bV9zdGF0X2RhdGEgKilkYXRhOwo+ICsJKnZhbCA9ICoodWxvbmcgKikoKHZvaWQgKilrdm0gKyBv
ZmZzZXQpOwo+ICsKPiArCXJldHVybiAwOwo+ICt9Cj4gICAKPiAtCSp2YWwgPSAqKHVsb25nICop
KCh2b2lkICopc3RhdF9kYXRhLT5rdm0gKyBzdGF0X2RhdGEtPm9mZnNldCk7Cj4gK3N0YXRpYyBp
bnQga3ZtX2NsZWFyX3N0YXRfcGVyX3ZtKHN0cnVjdCBrdm0gKmt2bSwgc2l6ZV90IG9mZnNldCkK
PiArewo+ICsJKih1bG9uZyAqKSgodm9pZCAqKWt2bSArIG9mZnNldCkgPSAwOwo+ICAgCj4gICAJ
cmV0dXJuIDA7Cj4gICB9Cj4gICAKPiAtc3RhdGljIGludCB2bV9zdGF0X2NsZWFyX3Blcl92bSh2
b2lkICpkYXRhLCB1NjQgdmFsKQo+ICtzdGF0aWMgaW50IGt2bV9nZXRfc3RhdF9wZXJfdmNwdShz
dHJ1Y3Qga3ZtICprdm0sIHNpemVfdCBvZmZzZXQsIHU2NCAqdmFsKQo+ICAgewo+IC0Jc3RydWN0
IGt2bV9zdGF0X2RhdGEgKnN0YXRfZGF0YSA9IChzdHJ1Y3Qga3ZtX3N0YXRfZGF0YSAqKWRhdGE7
Cj4gKwlpbnQgaTsKPiArCXN0cnVjdCBrdm1fdmNwdSAqdmNwdTsKPiAgIAo+IC0JaWYgKHZhbCkK
PiAtCQlyZXR1cm4gLUVJTlZBTDsKPiArCSp2YWwgPSAwOwo+ICAgCj4gLQkqKHVsb25nICopKCh2
b2lkICopc3RhdF9kYXRhLT5rdm0gKyBzdGF0X2RhdGEtPm9mZnNldCkgPSAwOwo+ICsJa3ZtX2Zv
cl9lYWNoX3ZjcHUoaSwgdmNwdSwga3ZtKQo+ICsJCSp2YWwgKz0gKih1NjQgKikoKHZvaWQgKil2
Y3B1ICsgb2Zmc2V0KTsKPiAgIAo+ICAgCXJldHVybiAwOwo+ICAgfQo+ICAgCj4gLXN0YXRpYyBp
bnQgdm1fc3RhdF9nZXRfcGVyX3ZtX29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZp
bGUgKmZpbGUpCj4gK3N0YXRpYyBpbnQga3ZtX2NsZWFyX3N0YXRfcGVyX3ZjcHUoc3RydWN0IGt2
bSAqa3ZtLCBzaXplX3Qgb2Zmc2V0KQo+ICAgewo+IC0JX19zaW1wbGVfYXR0cl9jaGVja19mb3Jt
YXQoIiVsbHVcbiIsIDB1bGwpOwo+IC0JcmV0dXJuIGt2bV9kZWJ1Z2ZzX29wZW4oaW5vZGUsIGZp
bGUsIHZtX3N0YXRfZ2V0X3Blcl92bSwKPiAtCQkJCXZtX3N0YXRfY2xlYXJfcGVyX3ZtLCAiJWxs
dVxuIik7Cj4gKwlpbnQgaTsKPiArCXN0cnVjdCBrdm1fdmNwdSAqdmNwdTsKPiArCj4gKwlrdm1f
Zm9yX2VhY2hfdmNwdShpLCB2Y3B1LCBrdm0pCj4gKwkJKih1NjQgKikoKHZvaWQgKil2Y3B1ICsg
b2Zmc2V0KSA9IDA7Cj4gKwo+ICsJcmV0dXJuIDA7Cj4gICB9Cj4gICAKPiAtc3RhdGljIGNvbnN0
IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgdm1fc3RhdF9nZXRfcGVyX3ZtX2ZvcHMgPSB7Cj4gLQku
b3duZXIgICA9IFRISVNfTU9EVUxFLAo+IC0JLm9wZW4gICAgPSB2bV9zdGF0X2dldF9wZXJfdm1f
b3BlbiwKPiAtCS5yZWxlYXNlID0ga3ZtX2RlYnVnZnNfcmVsZWFzZSwKPiAtCS5yZWFkICAgID0g
c2ltcGxlX2F0dHJfcmVhZCwKPiAtCS53cml0ZSAgID0gc2ltcGxlX2F0dHJfd3JpdGUsCj4gLQku
bGxzZWVrICA9IG5vX2xsc2VlaywKPiArc3RydWN0IGt2bV9zdGF0X29wZXJhdGlvbnMgewo+ICsJ
aW50ICgqZ2V0KShzdHJ1Y3Qga3ZtICprdm0sIHNpemVfdCBvZmZzZXQsIHU2NCAqdmFsKTsKPiAr
CWludCAoKmNsZWFyKShzdHJ1Y3Qga3ZtICprdm0sIHNpemVfdCBvZmZzZXQpOwo+ICt9Owo+ICsK
PiArc3RhdGljIGNvbnN0IHN0cnVjdCBrdm1fc3RhdF9vcGVyYXRpb25zIGt2bV9zdGF0X29wc1td
ID0gewo+ICsJW0tWTV9TVEFUX1ZNXSA9IHsgLmdldCA9IGt2bV9nZXRfc3RhdF9wZXJfdm0sCj4g
KwkJCSAgLmNsZWFyID0ga3ZtX2NsZWFyX3N0YXRfcGVyX3ZtIH0sCj4gKwlbS1ZNX1NUQVRfVkNQ
VV0gPSB7IC5nZXQgPSBrdm1fZ2V0X3N0YXRfcGVyX3ZjcHUsCj4gKwkJCSAgICAuY2xlYXIgPSBr
dm1fY2xlYXJfc3RhdF9wZXJfdmNwdSB9LAoKV2h5IGlzIHRoaXMgc3RydWN0IHN0aWxsIGhlcmU/
Cgo+ICAgfTsKPiAgIAo+IC1zdGF0aWMgaW50IHZjcHVfc3RhdF9nZXRfcGVyX3ZtKHZvaWQgKmRh
dGEsIHU2NCAqdmFsKQo+ICtzdGF0aWMgaW50IGt2bV9zdGF0X2RhdGFfZ2V0KHZvaWQgKmRhdGEs
IHU2NCAqdmFsKQo+ICAgewo+IC0JaW50IGk7Cj4gKwlpbnQgciA9IDA7CgpKdXN0IGluaXRpYWxp
emUgdGhpcyB0byAtRUZBVUxUIC4uLgoKPiAgIAlzdHJ1Y3Qga3ZtX3N0YXRfZGF0YSAqc3RhdF9k
YXRhID0gKHN0cnVjdCBrdm1fc3RhdF9kYXRhICopZGF0YTsKPiAtCXN0cnVjdCBrdm1fdmNwdSAq
dmNwdTsKPiAtCj4gLQkqdmFsID0gMDsKPiAgIAo+IC0Ja3ZtX2Zvcl9lYWNoX3ZjcHUoaSwgdmNw
dSwgc3RhdF9kYXRhLT5rdm0pCj4gLQkJKnZhbCArPSAqKHU2NCAqKSgodm9pZCAqKXZjcHUgKyBz
dGF0X2RhdGEtPm9mZnNldCk7Cj4gKwlzd2l0Y2ggKHN0YXRfZGF0YS0+ZGJnZnNfaXRlbS0+a2lu
ZCkgewo+ICsJY2FzZSBLVk1fU1RBVF9WTToKPiArCQlyID0ga3ZtX2dldF9zdGF0X3Blcl92bShz
dGF0X2RhdGEtPmt2bSwKPiArCQkJCQlzdGF0X2RhdGEtPmRiZ2ZzX2l0ZW0tPm9mZnNldCwgdmFs
KTsKPiArCQlicmVhazsKPiArCWNhc2UgS1ZNX1NUQVRfVkNQVToKPiArCQlyID0ga3ZtX2dldF9z
dGF0X3Blcl92Y3B1KHN0YXRfZGF0YS0+a3ZtLAo+ICsJCQkJCSAgc3RhdF9kYXRhLT5kYmdmc19p
dGVtLT5vZmZzZXQsIHZhbCk7Cj4gKwkJYnJlYWs7Cj4gKwlkZWZhdWx0Ogo+ICsJCXIgPSAtRUZB
VUxUOwoKLi4uIGFuZCB0aGVuIGRyb3AgZGVmYXVsdDogaGVyZS4KCj4gKwl9Cj4gICAKPiAtCXJl
dHVybiAwOwo+ICsJcmV0dXJuIHI7Cj4gICB9Cj4gICAKPiAtc3RhdGljIGludCB2Y3B1X3N0YXRf
Y2xlYXJfcGVyX3ZtKHZvaWQgKmRhdGEsIHU2NCB2YWwpCj4gK3N0YXRpYyBpbnQga3ZtX3N0YXRf
ZGF0YV9jbGVhcih2b2lkICpkYXRhLCB1NjQgdmFsKQo+ICAgewo+IC0JaW50IGk7Cj4gKwlpbnQg
ciA9IDA7CgpTYW1lCgoKQWxleAoKPiAgIAlzdHJ1Y3Qga3ZtX3N0YXRfZGF0YSAqc3RhdF9kYXRh
ID0gKHN0cnVjdCBrdm1fc3RhdF9kYXRhICopZGF0YTsKPiAtCXN0cnVjdCBrdm1fdmNwdSAqdmNw
dTsKPiAgIAo+ICAgCWlmICh2YWwpCj4gICAJCXJldHVybiAtRUlOVkFMOwo+ICAgCj4gLQlrdm1f
Zm9yX2VhY2hfdmNwdShpLCB2Y3B1LCBzdGF0X2RhdGEtPmt2bSkKPiAtCQkqKHU2NCAqKSgodm9p
ZCAqKXZjcHUgKyBzdGF0X2RhdGEtPm9mZnNldCkgPSAwOwo+ICsJc3dpdGNoIChzdGF0X2RhdGEt
PmRiZ2ZzX2l0ZW0tPmtpbmQpIHsKPiArCWNhc2UgS1ZNX1NUQVRfVk06Cj4gKwkJciA9IGt2bV9j
bGVhcl9zdGF0X3Blcl92bShzdGF0X2RhdGEtPmt2bSwKPiArCQkJCQkgIHN0YXRfZGF0YS0+ZGJn
ZnNfaXRlbS0+b2Zmc2V0KTsKPiArCQlicmVhazsKPiArCWNhc2UgS1ZNX1NUQVRfVkNQVToKPiAr
CQlyID0ga3ZtX2NsZWFyX3N0YXRfcGVyX3ZjcHUoc3RhdF9kYXRhLT5rdm0sCj4gKwkJCQkJICAg
IHN0YXRfZGF0YS0+ZGJnZnNfaXRlbS0+b2Zmc2V0KTsKPiArCQlicmVhazsKPiArCWRlZmF1bHQ6
Cj4gKwkJciA9IC1FRkFVTFQ7Cj4gKwl9Cj4gICAKPiAtCXJldHVybiAwOwo+ICsJcmV0dXJuIHI7
Cj4gICB9Cj4gICAKPiAtc3RhdGljIGludCB2Y3B1X3N0YXRfZ2V0X3Blcl92bV9vcGVuKHN0cnVj
dCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlKQo+ICtzdGF0aWMgaW50IGt2bV9zdGF0
X2RhdGFfb3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKPiAgIHsK
PiAgIAlfX3NpbXBsZV9hdHRyX2NoZWNrX2Zvcm1hdCgiJWxsdVxuIiwgMHVsbCk7Cj4gLQlyZXR1
cm4ga3ZtX2RlYnVnZnNfb3Blbihpbm9kZSwgZmlsZSwgdmNwdV9zdGF0X2dldF9wZXJfdm0sCj4g
LQkJCQkgdmNwdV9zdGF0X2NsZWFyX3Blcl92bSwgIiVsbHVcbiIpOwo+ICsJcmV0dXJuIGt2bV9k
ZWJ1Z2ZzX29wZW4oaW5vZGUsIGZpbGUsIGt2bV9zdGF0X2RhdGFfZ2V0LAo+ICsJCQkJa3ZtX3N0
YXRfZGF0YV9jbGVhciwgIiVsbHVcbiIpOwo+ICAgfQo+ICAgCj4gLXN0YXRpYyBjb25zdCBzdHJ1
Y3QgZmlsZV9vcGVyYXRpb25zIHZjcHVfc3RhdF9nZXRfcGVyX3ZtX2ZvcHMgPSB7Cj4gLQkub3du
ZXIgICA9IFRISVNfTU9EVUxFLAo+IC0JLm9wZW4gICAgPSB2Y3B1X3N0YXRfZ2V0X3Blcl92bV9v
cGVuLAo+ICtzdGF0aWMgY29uc3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBzdGF0X2ZvcHNfcGVy
X3ZtID0gewo+ICsJLm93bmVyID0gVEhJU19NT0RVTEUsCj4gKwkub3BlbiA9IGt2bV9zdGF0X2Rh
dGFfb3BlbiwKPiAgIAkucmVsZWFzZSA9IGt2bV9kZWJ1Z2ZzX3JlbGVhc2UsCj4gLQkucmVhZCAg
ICA9IHNpbXBsZV9hdHRyX3JlYWQsCj4gLQkud3JpdGUgICA9IHNpbXBsZV9hdHRyX3dyaXRlLAo+
IC0JLmxsc2VlayAgPSBub19sbHNlZWssCj4gLX07Cj4gLQo+IC1zdGF0aWMgY29uc3Qgc3RydWN0
IGZpbGVfb3BlcmF0aW9ucyAqc3RhdF9mb3BzX3Blcl92bVtdID0gewo+IC0JW0tWTV9TVEFUX1ZD
UFVdID0gJnZjcHVfc3RhdF9nZXRfcGVyX3ZtX2ZvcHMsCj4gLQlbS1ZNX1NUQVRfVk1dICAgPSAm
dm1fc3RhdF9nZXRfcGVyX3ZtX2ZvcHMsCj4gKwkucmVhZCA9IHNpbXBsZV9hdHRyX3JlYWQsCj4g
Kwkud3JpdGUgPSBzaW1wbGVfYXR0cl93cml0ZSwKPiArCS5sbHNlZWsgPSBub19sbHNlZWssCj4g
ICB9Owo+ICAgCj4gICBzdGF0aWMgaW50IHZtX3N0YXRfZ2V0KHZvaWQgKl9vZmZzZXQsIHU2NCAq
dmFsKQo+ICAgewo+ICAgCXVuc2lnbmVkIG9mZnNldCA9IChsb25nKV9vZmZzZXQ7Cj4gICAJc3Ry
dWN0IGt2bSAqa3ZtOwo+IC0Jc3RydWN0IGt2bV9zdGF0X2RhdGEgc3RhdF90bXAgPSB7Lm9mZnNl
dCA9IG9mZnNldH07Cj4gICAJdTY0IHRtcF92YWw7Cj4gICAKPiAgIAkqdmFsID0gMDsKPiAgIAlt
dXRleF9sb2NrKCZrdm1fbG9jayk7Cj4gICAJbGlzdF9mb3JfZWFjaF9lbnRyeShrdm0sICZ2bV9s
aXN0LCB2bV9saXN0KSB7Cj4gLQkJc3RhdF90bXAua3ZtID0ga3ZtOwo+IC0JCXZtX3N0YXRfZ2V0
X3Blcl92bSgodm9pZCAqKSZzdGF0X3RtcCwgJnRtcF92YWwpOwo+ICsJCWt2bV9nZXRfc3RhdF9w
ZXJfdm0oa3ZtLCBvZmZzZXQsICZ0bXBfdmFsKTsKPiAgIAkJKnZhbCArPSB0bXBfdmFsOwo+ICAg
CX0KPiAgIAltdXRleF91bmxvY2soJmt2bV9sb2NrKTsKPiBAQCAtNDE0MiwxNSArNDE2NSwxMyBA
QCBzdGF0aWMgaW50IHZtX3N0YXRfY2xlYXIodm9pZCAqX29mZnNldCwgdTY0IHZhbCkKPiAgIHsK
PiAgIAl1bnNpZ25lZCBvZmZzZXQgPSAobG9uZylfb2Zmc2V0Owo+ICAgCXN0cnVjdCBrdm0gKmt2
bTsKPiAtCXN0cnVjdCBrdm1fc3RhdF9kYXRhIHN0YXRfdG1wID0gey5vZmZzZXQgPSBvZmZzZXR9
Owo+ICAgCj4gICAJaWYgKHZhbCkKPiAgIAkJcmV0dXJuIC1FSU5WQUw7Cj4gICAKPiAgIAltdXRl
eF9sb2NrKCZrdm1fbG9jayk7Cj4gICAJbGlzdF9mb3JfZWFjaF9lbnRyeShrdm0sICZ2bV9saXN0
LCB2bV9saXN0KSB7Cj4gLQkJc3RhdF90bXAua3ZtID0ga3ZtOwo+IC0JCXZtX3N0YXRfY2xlYXJf
cGVyX3ZtKCh2b2lkICopJnN0YXRfdG1wLCAwKTsKPiArCQlrdm1fY2xlYXJfc3RhdF9wZXJfdm0o
a3ZtLCBvZmZzZXQpOwo+ICAgCX0KPiAgIAltdXRleF91bmxvY2soJmt2bV9sb2NrKTsKPiAgIAo+
IEBAIC00MTYzLDE0ICs0MTg0LDEyIEBAIHN0YXRpYyBpbnQgdmNwdV9zdGF0X2dldCh2b2lkICpf
b2Zmc2V0LCB1NjQgKnZhbCkKPiAgIHsKPiAgIAl1bnNpZ25lZCBvZmZzZXQgPSAobG9uZylfb2Zm
c2V0Owo+ICAgCXN0cnVjdCBrdm0gKmt2bTsKPiAtCXN0cnVjdCBrdm1fc3RhdF9kYXRhIHN0YXRf
dG1wID0gey5vZmZzZXQgPSBvZmZzZXR9Owo+ICAgCXU2NCB0bXBfdmFsOwo+ICAgCj4gICAJKnZh
bCA9IDA7Cj4gICAJbXV0ZXhfbG9jaygma3ZtX2xvY2spOwo+ICAgCWxpc3RfZm9yX2VhY2hfZW50
cnkoa3ZtLCAmdm1fbGlzdCwgdm1fbGlzdCkgewo+IC0JCXN0YXRfdG1wLmt2bSA9IGt2bTsKPiAt
CQl2Y3B1X3N0YXRfZ2V0X3Blcl92bSgodm9pZCAqKSZzdGF0X3RtcCwgJnRtcF92YWwpOwo+ICsJ
CWt2bV9nZXRfc3RhdF9wZXJfdmNwdShrdm0sIG9mZnNldCwgJnRtcF92YWwpOwo+ICAgCQkqdmFs
ICs9IHRtcF92YWw7Cj4gICAJfQo+ICAgCW11dGV4X3VubG9jaygma3ZtX2xvY2spOwo+IEBAIC00
MTgxLDE1ICs0MjAwLDEzIEBAIHN0YXRpYyBpbnQgdmNwdV9zdGF0X2NsZWFyKHZvaWQgKl9vZmZz
ZXQsIHU2NCB2YWwpCj4gICB7Cj4gICAJdW5zaWduZWQgb2Zmc2V0ID0gKGxvbmcpX29mZnNldDsK
PiAgIAlzdHJ1Y3Qga3ZtICprdm07Cj4gLQlzdHJ1Y3Qga3ZtX3N0YXRfZGF0YSBzdGF0X3RtcCA9
IHsub2Zmc2V0ID0gb2Zmc2V0fTsKPiAgIAo+ICAgCWlmICh2YWwpCj4gICAJCXJldHVybiAtRUlO
VkFMOwo+ICAgCj4gICAJbXV0ZXhfbG9jaygma3ZtX2xvY2spOwo+ICAgCWxpc3RfZm9yX2VhY2hf
ZW50cnkoa3ZtLCAmdm1fbGlzdCwgdm1fbGlzdCkgewo+IC0JCXN0YXRfdG1wLmt2bSA9IGt2bTsK
PiAtCQl2Y3B1X3N0YXRfY2xlYXJfcGVyX3ZtKCh2b2lkICopJnN0YXRfdG1wLCAwKTsKPiArCQlr
dm1fY2xlYXJfc3RhdF9wZXJfdmNwdShrdm0sIG9mZnNldCk7Cj4gICAJfQo+ICAgCW11dGV4X3Vu
bG9jaygma3ZtX2xvY2spOwo+ICAgCj4gQEAgLTQyNjIsOSArNDI3OSw4IEBAIHN0YXRpYyB2b2lk
IGt2bV9pbml0X2RlYnVnKHZvaWQpCj4gICAKPiAgIAlrdm1fZGVidWdmc19udW1fZW50cmllcyA9
IDA7Cj4gICAJZm9yIChwID0gZGVidWdmc19lbnRyaWVzOyBwLT5uYW1lOyArK3AsIGt2bV9kZWJ1
Z2ZzX251bV9lbnRyaWVzKyspIHsKPiAtCQlpbnQgbW9kZSA9IHAtPm1vZGUgPyBwLT5tb2RlIDog
MDY0NDsKPiAtCQlkZWJ1Z2ZzX2NyZWF0ZV9maWxlKHAtPm5hbWUsIG1vZGUsIGt2bV9kZWJ1Z2Zz
X2RpciwKPiAtCQkJCSAgICAodm9pZCAqKShsb25nKXAtPm9mZnNldCwKPiArCQlkZWJ1Z2ZzX2Ny
ZWF0ZV9maWxlKHAtPm5hbWUsIEtWTV9EQkdGU19HRVRfTU9ERShwKSwKPiArCQkJCSAgICBrdm1f
ZGVidWdmc19kaXIsICh2b2lkICopKGxvbmcpcC0+b2Zmc2V0LAo+ICAgCQkJCSAgICBzdGF0X2Zv
cHNbcC0+a2luZF0pOwo+ICAgCX0KPiAgIH0KPiAKCgoKQW1hem9uIERldmVsb3BtZW50IENlbnRl
ciBHZXJtYW55IEdtYkgKS3JhdXNlbnN0ci4gMzgKMTAxMTcgQmVybGluCkdlc2NoYWVmdHNmdWVo
cnVuZzogQ2hyaXN0aWFuIFNjaGxhZWdlciwgUmFsZiBIZXJicmljaApFaW5nZXRyYWdlbiBhbSBB
bXRzZ2VyaWNodCBDaGFybG90dGVuYnVyZyB1bnRlciBIUkIgMTQ5MTczIEIKU2l0ejogQmVybGlu
ClVzdC1JRDogREUgMjg5IDIzNyA4NzkKCgo=

