Return-Path: <kvm-owner@vger.kernel.org>
X-Original-To: lists+kvm@lfdr.de
Delivered-To: lists+kvm@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id E8F6C7D6473
	for <lists+kvm@lfdr.de>; Wed, 25 Oct 2023 10:05:04 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S233065AbjJYIFE (ORCPT <rfc822;lists+kvm@lfdr.de>);
        Wed, 25 Oct 2023 04:05:04 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:40554 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S230147AbjJYIFD (ORCPT <rfc822;kvm@vger.kernel.org>);
        Wed, 25 Oct 2023 04:05:03 -0400
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 33EB091
        for <kvm@vger.kernel.org>; Wed, 25 Oct 2023 01:05:02 -0700 (PDT)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 81F4AC433C7;
        Wed, 25 Oct 2023 08:05:01 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1698221101;
        bh=iSkD8tZvQK6fMOgU/tZVlBiEwFdIr6jy+fjpc6gQDTw=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=mlB0h8InEChKt3EO1uzCZjqEjlt27/GfC5rSJHBS2pL7VO7B8N0Okbrt9mMHmBybz
         YgrnK1gzARKA2T05KSKw/ZyWlOMCBKPKekOKs7TBufsaS45VuwmTV4mUwlqUTB+erN
         /8/Kojb1q0qBrdWmzrEJ84/uvtQT84ecH64indJu/vVQ74c/7eT4SznOuOnC2RrGuF
         zRgpN1Hs03A72sLOkRWhSPpXSnwUQXm7uIB7+VKfwahvolIj6RO04/KRY1pQI8zpIf
         cn4mfUs5F4snvDhm+nREcTHLChpcyGnuMjsvDM3fwIDqOZ4Z3x8d2PxhHVVYtXQqs4
         LlrWDMSiKdFEw==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.95)
        (envelope-from <maz@kernel.org>)
        id 1qvYst-007TE8-20;
        Wed, 25 Oct 2023 09:04:59 +0100
Date:   Wed, 25 Oct 2023 09:04:58 +0100
Message-ID: <86il6v3z6d.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Oliver Upton <oliver.upton@linux.dev>
Cc:     kvmarm@lists.linux.dev, kvm@vger.kernel.org,
        James Morse <james.morse@arm.com>,
        Suzuki K Poulose <suzuki.poulose@arm.com>,
        Zenghui Yu <yuzenghui@huawei.com>
Subject: Re: [PATCH] KVM: arm64: Stop printing about MMIO accesses where ISV==0
In-Reply-To: <20231024210739.1729723-1-oliver.upton@linux.dev>
References: <20231024210739.1729723-1-oliver.upton@linux.dev>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/29.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: oliver.upton@linux.dev, kvmarm@lists.linux.dev, kvm@vger.kernel.org, james.morse@arm.com, suzuki.poulose@arm.com, yuzenghui@huawei.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
X-Spam-Status: No, score=-4.4 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_MED,
        SPF_HELO_NONE,SPF_PASS autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <kvm.vger.kernel.org>
X-Mailing-List: kvm@vger.kernel.org

On Tue, 24 Oct 2023 22:07:39 +0100,
Oliver Upton <oliver.upton@linux.dev> wrote:
> 
> It is a pretty well known fact that KVM does not support MMIO emulation
> without valid instruction syndrome information (ESR_EL2.ISV == 0). The
> dmesg is useless as it provides zero context and just winds up polluting
> logs. Let's just delete it.
> 
> Any userspace that cares should just use KVM_CAP_ARM_NISV_TO_USER, which
> inherently ties to a vCPU context.
> 
> Signed-off-by: Oliver Upton <oliver.upton@linux.dev>
> ---
>  arch/arm64/kvm/mmio.c | 1 -
>  1 file changed, 1 deletion(-)
> 
> diff --git a/arch/arm64/kvm/mmio.c b/arch/arm64/kvm/mmio.c
> index 3dd38a151d2a..a53721be32ec 100644
> --- a/arch/arm64/kvm/mmio.c
> +++ b/arch/arm64/kvm/mmio.c
> @@ -143,7 +143,6 @@ int io_mem_abort(struct kvm_vcpu *vcpu, phys_addr_t fault_ipa)
>  			return 0;
>  		}
>  
> -		kvm_pr_unimpl("Data abort outside memslots with no valid syndrome info\n");
>  		return -ENOSYS;
>  	}
>  
> 

While I totally agree that this *debug* statement should go, we should
also replace it with something else.

Because when you're trying to debug a guest (or even KVM itself),
seeing this message is a sure indication that the guest is performing
an access outside of memory. The fact that KVM tries to handle it as
MMIO is just an implementation artefact.

So I'd very much welcome a replacement tracepoint giving a bit more
information, such as guest PC, IPA being accessed, load or store. With
that, everybody wins.

Thanks,

	M.

-- 
Without deviation from the norm, progress is not possible.
